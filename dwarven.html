<!DOCTYPE html>
  <html lang = "en">
    <head>
      <title>adjectils - Dwarven Mines</title>
      <link rel="stylesheet" href="stylesheet.css">
      <meta name = "description" content = "Dwarven utilities for Hypixel SkyBlock">
      <meta name = "author" content = "adjective_n0un">
      <meta name = "viewport" content="width=device-width, initial-scale=0.6">
      <link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
      <link rel="manifest" href="./favicon/site.webmanifest">
      <script type="text/javascript" src="/jquery-3.6.3.min.js"></script>
      <script src = "apireader.js"></script>
      <script src = "timeToMinutes.js"></script>
      <script src = "dwarvendata.js"></script>
      <script src = "binomials.js"></script>
    </head>
  <body onload="updatePage()" style = "background-image:url(./images/dwarvenbg.png); background-size:15%">
  
      <script>
      $(function(){
        $("#nav").load("nav.html", function() { setWord(); }); 
      });
      </script>
  
  <header id = "nav" class = navblock></header>
  <div style = "margin-bottom: 30px;">&nbsp;</div>
  <div class = "standardwidth" style = "text-align:center">
  <label style = "background-color:#282828">Username: <input type = "text" id = "nameinput" onchange = updateForges(value)>&nbsp;</label><button onclick = updateForges(nameinput.value) style = "width: 80px; height: 24px; text-align:center">Refresh ⟳</button><span>&nbsp;</span><span id = "refreshstatus"></span><br>
  <div>
  <span id = "status" style = "background-color: #282828;">Enter a username to continue.&nbsp;</span>
  </div>
  <div>
    <span id = "refresh" style = "background-color: #282828;">00s since last refresh.&nbsp;</span>
    </div>
  <br>
  <div style = "background-color: #282828;">
    
      <label>Profile:
      <select id = profileid value = 4 onchange = updateForges(nameinput.value)>
        <option id = profile0 value = 0>–––––</option>
        <option id = profile1 value = 1>–––––</option>
        <option id = profile2 value = 2>–––––</option>
        <option id = profile3 value = 3>–––––</option>
        <option id = profile4 value = 4>–––––</option>
      </select>
      </label>
  </div>
  
  </div>
  <section class = "flex_box_index">
  <div class = "dwarven_block " style = "width:min(calc(100% - 30px), max(800px, 40%)); margin:auto">
    <span class = minesheader>Forge timers</span><br><br>
    <span class = basictext>Quick Forge level: </span><span class = basictext id = quickforgelevel>0</span><br><br>
    <div id = "coleselectdiv">
      <label>Molten Forge:
      <select id = "cole" onchange = updateCata(nameinput.value)>
          <option value = 0>Inactive</option>
          <option value = 0.25>Active (-25% forge time)</option>
      </select>
      </label>
  </div>
    <div style = "display:flex;flex-basis: min(calc(100% - 30px), max(600px, 65%)); margin-top:20px">
      <span style = "margin-right:20px">Notify me when forges complete</span>
      <div>

        <label class = "switchbox" id = "notifyswitch" for = "notify">
          <input type = "checkbox"  id = "notify" onchange = toggleEventNotif() aria-labelledby = "notifyswitch" style = "opacity:0">
          <span class = "switch"></span>
        </label>
      </div>
      <div>
      </div>
      </div>
      <div class = "flex_full_row">
        <span id = "notifstatus">(Notifications disabled)</span>
      </div>

    <div id = "item1" class = "flex_forge_box">
      <div style = "float:left; width:40px; height:40px; margin:5px;">
        <img id = "img1" style = "width:40px; height:40px; opacity:0" src = "./images/filler.png">
      </div>
      <div style = "display:inline-block; margin:5px; height:40px; margin-left:10px;">
        <span style = "font-size:18px">Slot 1: </span><span id = "forgeitem_1" style = "font-size:16px">None</span><br>
        <span class = meter>[</span><span class = meter id = forgemeter1>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><span class = meter id = forgeunmeter1></span><span class = meter>]</span>
      </div>
      <div id = timers1>
      <div style = "display:inline-block; margin:5px; margin-left: 20px; height:40px">
        <span>&nbsp;Remaining time:&nbsp;</span><br>
        <span>&nbsp;Completion time:&nbsp;</span>
      </div>
      <div style = "display:inline-block; margin:5px; height:40px">
        <span id = time1>&ndash;&ndash;:&ndash;&ndash;</span><br>
        <span id = finish1>&ndash;&ndash;:&ndash;&ndash;</span>
      </div>
      </div>
    </div>
    <div id = "item2" class = "flex_forge_box">
      <div style = "float:left; width:40px; height:40px; margin:5px;">
        <img id = "img2" style = "width:40px; height:40px; opacity:0" src = "./images/filler.png">
      </div>
      <div style = "display:inline-block; margin:5px; height:40px; margin-left:10px;">
        <span style = "font-size:18px">Slot 2: </span><span id = "forgeitem_2" style = "font-size:16px">None</span><br>
        <span class = meter>[</span><span class = meter id = forgemeter2>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><span class = meter id = forgeunmeter2></span><span class = meter>]</span>
      </div>
      <div id = timers2>
      <div style = "display:inline-block; margin:5px; margin-left: 20px; height:40px">
        <span>&nbsp;Remaining time:&nbsp;</span><br>
        <span>&nbsp;Completion time:&nbsp;</span>
      </div>
      <div style = "display:inline-block; margin:5px; height:40px">
        <span id = time2>&ndash;&ndash;:&ndash;&ndash;</span><br>
        <span id = finish2>&ndash;&ndash;:&ndash;&ndash;</span>
      </div>
      </div>
    </div>
    <div id = "item3" class = "flex_forge_box">
      <div style = "float:left; width:40px; height:40px; margin:5px;">
        <img id = "img3" style = "width:40px; height:40px; opacity:0" src = "./images/filler.png">
      </div>
      <div style = "display:inline-block; margin:5px; height:40px; margin-left:10px;">
        <span style = "font-size:18px">Slot 3: </span><span id = "forgeitem_3" style = "font-size:16px">None</span><br>
        <span class = meter>[</span><span class = meter id = forgemeter3>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><span class = meter id = forgeunmeter3></span><span class = meter>]</span>
      </div>
      <div id = timers3>
      <div style = "display:inline-block; margin:5px; margin-left: 20px; height:40px">
        <span>&nbsp;Remaining time:&nbsp;</span><br>
        <span>&nbsp;Completion time:&nbsp;</span>
      </div>
      <div style = "display:inline-block; margin:5px; height:40px">
        <span id = time3>&ndash;&ndash;:&ndash;&ndash;</span><br>
        <span id = finish3>&ndash;&ndash;:&ndash;&ndash;</span>
      </div>
      </div>
    </div>
    <div id = "item4" class = "flex_forge_box">
      <div style = "float:left; width:40px; height:40px; margin:5px;">
        <img id = "img4" style = "width:40px; height:40px; opacity:0" src = "./images/filler.png">
      </div>
      <div style = "display:inline-block; margin:5px; height:40px; margin-left:10px;">
        <span style = "font-size:18px">Slot 4: </span><span id = "forgeitem_4" style = "font-size:16px">None</span><br>
        <span class = meter>[</span><span class = meter id = forgemeter4>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><span class = meter id = forgeunmeter4></span><span class = meter>]</span>
      </div>
      <div id = timers4>
      <div style = "display:inline-block; margin:5px; margin-left: 20px; height:40px">
        <span>&nbsp;Remaining time:&nbsp;</span><br>
        <span>&nbsp;Completion time:&nbsp;</span>
      </div>
      <div style = "display:inline-block; margin:5px; height:40px;">
        <span id = time4>&ndash;&ndash;:&ndash;&ndash;</span><br>
        <span id = finish4>&ndash;&ndash;:&ndash;&ndash;</span>
      </div>
      </div>
    </div>
    <div id = "item5" class = "flex_forge_box"> 
      <div style = "float:left; width:40px; height:40px; margin:5px;">
        <img id = "img5" style = "width:40px; height:40px; opacity:0" src = "./images/filler.png">
      </div>
      <div style = "display:inline-block; margin:5px; height:40px; margin-left:10px;">
        <span style = "font-size:18px">Slot 5: </span><span id = "forgeitem_5" style = "font-size:16px">None</span><br>
        <span class = meter>[</span><span class = meter id = forgemeter5>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><span class = meter id = forgeunmeter5></span><span class = meter>]</span>
      </div>
      <div id = timers5>
      <div style = "display:inline-block; margin:5px; margin-left: 20px; height:40px">
        <span>&nbsp;Remaining time:&nbsp;</span><br>
        <span>&nbsp;Completion time:&nbsp;</span>
      </div>
      <div style = "display:inline-block; margin:5px; height:40px">
        <span id = time5>&ndash;&ndash;:&ndash;&ndash;</span><br>
        <span id = finish5>&ndash;&ndash;:&ndash;&ndash;</span>
      </div>
      </div>
    </div>
    <div id = "item6" class = "flex_forge_box"> 
      <div style = "float:left; width:40px; height:40px; margin:5px;">
        <img id = "img6" style = "width:40px; height:40px; opacity:0" src = "./images/filler.png">
      </div>
      <div style = "display:inline-block; margin:5px; height:40px; margin-left:10px;">
        <span style = "font-size:18px">Slot 6: </span><span id = "forgeitem_6" style = "font-size:16px">None</span><br>
        <span class = meter>[</span><span class = meter id = forgemeter6>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><span class = meter id = forgeunmeter6></span><span class = meter>]</span>
      </div>
      <div id = timers6>
      <div style = "display:inline-block; margin:5px; margin-left: 20px; height:40px">
        <span>&nbsp;Remaining time:&nbsp;</span><br>
        <span>&nbsp;Completion time:&nbsp;</span>
      </div>
      <div style = "display:inline-block; margin:5px; height:40px">
        <span id = time6>&ndash;&ndash;:&ndash;&ndash;</span><br>
        <span id = finish6>&ndash;&ndash;:&ndash;&ndash;</span>
      </div>
      </div>
    </div>
    <div id = "item7" class = "flex_forge_box"> 
      <div style = "float:left; width:40px; height:40px; margin:5px;">
        <img id = "img7" style = "width:40px; height:40px; opacity:0" src = "./images/filler.png">
      </div>
      <div style = "display:inline-block; margin:5px; height:40px; margin-left:10px;">
        <span style = "font-size:18px">Slot 7: </span><span id = "forgeitem_7" style = "font-size:16px">None</span><br>
        <span class = meter>[</span><span class = meter id = forgemeter7>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span><span class = meter id = forgeunmeter7></span><span class = meter>]</span>
      </div>
      <div id = timers7>
      <div style = "display:inline-block; margin:5px; margin-left: 20px; height:40px">
        <span>&nbsp;Remaining time:&nbsp;</span><br>
        <span>&nbsp;Completion time:&nbsp;</span>
      </div>
      <div style = "display:inline-block; margin:5px; height:40px">
        <span id = time7>&ndash;&ndash;:&ndash;&ndash;</span><br>
        <span id = finish7>&ndash;&ndash;:&ndash;&ndash;</span>
      </div>
      </div>
    </div>
      
  </div>
  <br>
  <div style = "flex-basis:100%;width:min(calc(100% - 30px), max(800px, 40%)); margin:auto" class = "dwarven_block">
    <span class = minesheader>Corpse Loot</span><br><br>
    <div style = "margin-bottom: 20px;">
      <span><span id = "lootedname">Player</span>'s looted corpses:</span>
      <table style="margin-top: 20px;">
        <tr>
          <td>Lapis: </td><td id = "lapislooted" class = "tdalignright">0</td>
        </tr>
        <tr>
          <td>Metal: </td><td id = "metallooted" class = "tdalignright">0</td>
        </tr>
        <tr>
          <td>Vanguard: </td><td id = "vanguardlooted" class = "tdalignright">0</td>
        </tr>
      </table>
      <span class = "fineprint" id = "warningtext">Input a username at the top of the page to view their corpse looting stats.</span>
    </div>
    <div>
        <label>Corpse:
          <select id = corpsetype value = 0 onchange = updateCorpses()>
            <option value = vanguard>Vanguard</option>
            <option value = metal>Umber/Tungsten</option>
          </select>
        </label>
        <br>
        <label>Gifts from the Departed: <input type = "number" id = "gftd" value = 0 min = "0" max = "101" onchange = updateCorpses()>&nbsp;</label>

        <table style = "align-items: center; margin-top:20px; margin-bottom: 20px;">
          <tr><td style = "padding-right:20px; display:flex">
        <br>Jasper Crystal obtained:</td><td style = "padding-left: 20px;">
        <label class = "switchbox" id = "jasper-switch" for = "jasper-crystal">
          <input type = "checkbox"  id = "jasper-crystal" onchange = toggleJasper() aria-labelledby = "jasper-switch" style = "opacity:0">
          <span class = "switch"></span>
        </label>
        </tr><tr><td style = "padding-right:20px; display:flex">
        <br>Ruby Crystal obtained:</td><td style = "padding-left: 20px;">
        <label class = "switchbox" id = "ruby-switch" for = "ruby-crystal">
          <input type = "checkbox"  id = "ruby-crystal" onchange = toggleRuby() aria-labelledby = "ruby-switch" style = "opacity:0">
          <span class = "switch"></span>
        </label>
      </tr><tr><td style = "padding-right:20px; display:flex">
        <br>Opal Crystal obtained:</td><td style = "padding-left: 20px;">
        <label class = "switchbox" id = "opal-switch" for = "opal-crystal">
          <input type = "checkbox"  id = "opal-crystal" onchange = toggleOpal() aria-labelledby = "opal-switch" style = "opacity:0">
          <span class = "switch"></span>
        </label>
      </tr><tr><td style = "padding-right:20px; display:flex">
        <br>Aquamarine Crystal obtained:</td><td style = "padding-left: 20px;">
        <label class = "switchbox" id = "aqua-switch" for = "aqua-crystal">
          <input type = "checkbox"  id = "aqua-crystal" onchange = toggleAqua() aria-labelledby = "aqua-switch" style = "opacity:0">
          <span class = "switch"></span>
        </label>
      </tr><tr><td style = "padding-right:20px; display:flex">
        <br>Peridot Crystal obtained:</td><td style = "padding-left: 20px;">
        <label class = "switchbox" id = "peridot-switch" for = "peridot-crystal">
          <input type = "checkbox"  id = "peridot-crystal" onchange = togglePeridot() aria-labelledby = "peridot-switch" style = "opacity:0">
          <span class = "switch"></span>
        </label>
      </tr><tr><td style = "padding-right:20px; display:flex">
        <br>Onyx Crystal obtained:</td><td style = "padding-left: 20px;">
        <label class = "switchbox" id = "onyx-switch" for = "onyx-crystal">
          <input type = "checkbox"  id = "onyx-crystal" onchange = toggleOnyx() aria-labelledby = "onyx-switch" style = "opacity:0">
          <span class = "switch"></span>
        </label>
      </tr><tr><td style = "padding-right:20px; display:flex">
        <br>Citrine Crystal obtained:</td><td style = "padding-left: 20px;">
        <label class = "switchbox" id = "citrine-switch" for = "citrine-crystal">
          <input type = "checkbox"  id = "citrine-crystal" onchange = toggleCitrine() aria-labelledby = "citrine-switch" style = "opacity:0">
          <span class = "switch"></span>
        </label>
        </table>
      
    </div>

    <table id = "corpsetable" style = "width:50%">
    </table>

  </div>
  </section>
  <div style = "margin-top:20px">&nbsp;</div>
      <span style = "position: fixed; bottom: 0; left: 0; background-color: #282828; width: 100%; height:20px;">&nbsp;•&nbsp;made with <span id = "word">love</span> by <a href = "https://github.com/adjectiven0un" style = "color:#808080">adjective_noun</a> with help from <a href = "https://brookie.dev" style = "color:#f6adc6 ">BrookeAFK</a> </a>&nbsp;•&nbsp;&nbsp;•&nbsp;have feedback? visit my <a href = "https://discord.gg/NvQTDDrnSd" style = "color:#808080">discord</a>&nbsp;•&nbsp;</span>
  </body>
  <script>
    pagedata = ["Dwarven Mines", "#70c0c0"];
    var fasttrack = false;
    var data;
    async function updatePage(){
      updateSizes();
      if (localStorage.getItem("lastreset") != null) {
        var currenttime = Date.now();
        var secondssince = Math.floor((currenttime - localStorage.getItem("lastreset"))/1000);
        refresh.innerText = betterTimestamp(secondssince) + " since last refresh.";
      }
        console.log("Stored a name: " + localStorage.getItem("storedname"));
        
        if (localStorage.getItem("storedname") != null){
            console.log("Found a previous name and data! Loading...");
            console.log("Previous name: " + localStorage.getItem("storedname"));
            console.log("Previous data: " + localStorage.getItem("storeddata"));
            document.getElementById("nameinput").value = localStorage.getItem("storedname");
            data = JSON.parse(localStorage.getItem("storeddata"));
            fasttrack = true;
            updateForges(localStorage.getItem("storedname"));
            
        }
        corpsetype.value = "vanguard";
        updateCorpses();
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = false;
        });
    }
    const intervalID = [];
    const refreshInterval = [];
    var onCD = false;
    var eventNotifs = 0;
    var notifPerms = 0;
    
    function reset(){
      for (var i = 1; i <= 7; i++){
            document.getElementById("time" + i).innerText = "––:––";
            document.getElementById("finish" + i).innerText = "––:––";
            document.getElementById("forgeunmeter" + i).innerText = "";
            document.getElementById("forgeitem_" + i).innerText = "None";
            document.getElementById("refresh").innerText = "00s since last refresh.";
            document.getElementById("forgemeter" + i).style.color = "#c0c0c0";
            document.getElementById("forgemeter" + i).innerText = "||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||";
            document.getElementById("img" + i).style.opacity = 0;
            document.getElementById("img" + i).src = "./images/filler.png";
          }
          lootedname.innerText = "Player";
          lapislooted.innerText = "0";
          metallooted.innerText = "0";
          vanguardlooted.innerText = "0";
          warningtext.style.visibility = "visible";
          console.log("No active forges");
          
    }
    var lastname = "";
    
    async function updateForges(name){
      clearInterval(refreshInterval[0]);
      clearInterval(intervalID[0]);
      reset();
      if (onCD == true){
        document.getElementById("refreshstatus").innerText = "Please wait 5 seconds before using this again.";
        console.log("On cooldown!");
        return -1;
      } else {
        document.getElementById("refreshstatus").innerText = "";
        if (!fasttrack){
            onCD = true;
            setTimeout(() => { onCD = false }, 5000);
        }
      }
      
      if (!fasttrack){
        localStorage.setItem("lastreset", Date.now());
        console.log("Last reset: " + localStorage.getItem("lastreset"));
      } else {
        var currenttime = Date.now();
        var secondssince = Math.floor((currenttime - localStorage.getItem("lastreset"))/1000);
        refresh.innerText = betterTimestamp(secondssince) + " since last refresh.";
      }

      var UUID = await getUUIDbyName(name);
      if (UUID == -1) {
        return -1;
      }
      if (!fasttrack){
        data = await getAPIdata(UUID);
      }
      fasttrack = false;
      if (data.profiles == null) {
        document.getElementById("status").innerText = "This player hasn't played on Hypixel!"
        return -1;
      }
      if (lastname != name){

      
      
      
      
      intervalID.length = 0;
      
      //try {
        
        
        var profilelist;
        if (lastname != name) {
          updateProfiles(data);
        }
        
        lastname = name;
        
      }
        localStorage.setItem("storedname", name);
        localStorage.setItem("storeddata", JSON.stringify(data));
        var forgelog;
        try {
          forgelog = (data.profiles[profileid.value].members[UUID].forge.forge_processes.forge_1);
        } catch (TypeError){
          reset();
          forgelog = "Empty";
        }
        var quickforge;
        try {
          quickforge = (data.profiles[profileid.value].members[UUID].mining_core.nodes.forge_time);
        } catch (TypeError){
          quickforge = 0;
        }
        if (quickforge == undefined){
          quickforge = 0;
        }
        var qfm = quickforgetimes[quickforge];
        document.getElementById("quickforgelevel").innerText = quickforge;
        
        for (var i = 1; i <= 7; i++){
          try {
            if (forgelog[i].id != undefined){
              document.getElementById("forgeitem_" + i).innerText = translations[forgelog[i].id];
              console.log("Item ID: " + forgelog[i].id);
              document.getElementById("img" + i).src = "./images/forge_items/" + forgelog[i].id + ".png";
              document.getElementById("img" + i).style.opacity = 1;
            } else {
              
              document.getElementById("forgeitem_" + i).innerText = "None";
              
            }
          }
          catch (TypeError) {
            document.getElementById("forgeitem_" + i).innerText = "None";
          }
          
        }
        for (var i = 1; i <= 7; i++){
          try {
            if (forgelog[i].id != undefined){
              var maxtime = (qfm - cole.value) * times[forgelog[i].id];
              var finaltime = new Date(forgelog[i].startTime + (maxtime*1000));
              document.getElementById("finish" + i).innerText = finaltime.getHours() + ":" + fixTime(finaltime.getMinutes()) + ":" + fixTime(finaltime.getSeconds()) + " – " + months[finaltime.getMonth()] + " " + finaltime.getDate();
            } else {
              document.getElementById("finish" + i).innerText = "––:––";
            }
            
          } catch (TypeError){
            document.getElementById("finish" + i).innerText = "––:––";
          }
          
        }
        var interval = setInterval(() => updateTimers((qfm - cole.value), forgelog), 1000);
        intervalID.push(interval);
        var refreshint = setInterval(updateRefresh, 1000);
        refreshInterval[0] = refreshint;
        var corpsedata;
        try {
          corpsedata = (data.profiles[profileid.value].members[UUID].glacite_player_data.corpses_looted);
          lootedname.innerText = name;
          lapislooted.innerText = corpsedata.lapis.toLocaleString();
          metallooted.innerText = (corpsedata.umber + corpsedata.tungsten).toLocaleString();
          vanguardlooted.innerText = corpsedata.vanguard.toLocaleString();
          warningtext.style.visibility = "hidden";
        } catch (TypeError){
          lootedname.innerText = "Player";
          lapislooted.innerText = "0";
          metallooted.innerText = "0";
          vanguardlooted.innerText = "0";
          warningtext.style.visibility = "visible";

        }

        
        
      
    }
    async function updateRefresh() {
      var currenttime = Date.now();
      var secondssince = Math.floor((currenttime - localStorage.getItem("lastreset"))/1000);
      refresh.innerText = betterTimestamp(secondssince) + " since last refresh.";
    }
    async function updateTimers(qfm, forgelog){
      var actives = [1, 1, 1, 1, 1];
      if (forgelog == "Empty"){
        for (var i = 1; i <= 7; i++){
          document.getElementById("time" + i).innerText = "––:––";
          document.getElementById("finish" + i).innerText = "––:––";
          document.getElementById("forgeunmeter" + i).innerText = "";
          document.getElementById("forgemeter" + i).style.color = "#c0c0c0";
          document.getElementById("forgemeter" + i).innerText = "||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||";
        }
        clearInterval(intervalID[0]);
        intervalID.length = 0;
      } else {
        for (var i = 1; i <= 7; i++){
          try {
            var timeelapsed = ((Date.now() - forgelog[i].startTime)/1000);
            var maxtime = qfm * times[forgelog[i].id];
            var dontnotify = false;
            if (timeelapsed > maxtime){
              //1 second buffer for consistency purposes
              if (timeelapsed - maxtime > 1) {
                dontnotify = true;
              }
              timeelapsed = maxtime;
            }
            var timeremaining = (maxtime - timeelapsed).toFixed(0);
            var ticks = ((timeelapsed / maxtime) * 60).toFixed(0);
            if (timeremaining < 0){
              timeremaining = 0;
            }
            else if (timeremaining == 0){
              actives[i - 1] = 0;
              document.getElementById("time" + i).innerText = "Finished!";
              
              //send notif here
              if (eventNotifs == 1 && notifPerms == 1 && dontnotify == false){
                  var notification = new Notification("adjectils", {body:  translations[forgelog[i].id] + " forge process complete", icon: "./favicon/favicon.ico"});
              }
              

            } else {
              document.getElementById("time" + i).innerText = timeToMinutes(timeremaining);
            }
            
            var chunk1 = "";
            var chunk2 = "";
            for (var j = 0; j < ticks; j++){
              chunk1 = chunk1 + "|";
            }
            for (var j = ticks; j < 60; j++){
              chunk2 = chunk2 + "|";
            }
            var redhex = (60-ticks) * 4;
            var greenhex = (ticks) * 4;
            if (redhex == 0){
              redhex = "00";
            } else if (redhex < 16){
              redhex = "0" + redhex.toString(16);
            } else if (redhex % 16 == 0){
              redhex = redhex.toString(16);
            } else {
              redhex = redhex.toString(16);
            }
            
            if (greenhex == 0){
              greenhex = "00";
            } else if (greenhex < 16){
              greenhex = "0" + greenhex.toString(16);
            } else if (greenhex % 16 == 0){
              greenhex = greenhex.toString(16);
            } else {
              greenhex = greenhex.toString(16);
            }
            var hexcolor = "";
            hexcolor = "#" + redhex + greenhex + "00";
            document.getElementById("forgemeter" + i).style.color = hexcolor;
            document.getElementById("forgemeter" + i).innerText = chunk1;
            document.getElementById("forgeunmeter" + i).innerText = chunk2;
            
          } catch (TypeError) {
            actives[i - 1] = 0;
            document.getElementById("time" + i).innerText = "Inactive";
          }
        }
        
      }
      if (actives[0] == 0 && actives[1] == 0 && actives[2] == 0 && actives[3] == 0 && actives[4] == 0){
        console.log("All items complete");
        clearInterval(intervalID[0]);
        intervalID.length = 0;
      }
    }
    window.addEventListener('resize', updateSizes());
    function updateSizes(){
        if (window.innerWidth >= 768 * (5/3)) {
            console.log("Desktop mode...");
            for (var i = 1; i <= 7; i++){
                document.getElementById("timers" + i).style.flexBasis = "";
            }
      
        } else {
            console.log("Mobile mode...");
            for (var i = 1; i <= 7; i++){
                document.getElementById("timers" + i).style.flexBasis = "100%";
            }
      
        }
    }
    function toggleEventNotif(){
      eventNotifs = Math.abs(eventNotifs - 1);
      if (eventNotifs == 1){
        Notification.requestPermission().then(
        function(permission){
          if (permission == "granted"){
            console.log("Notifications enabled");
            document.getElementById("notifstatus").innerText = "(Notifications enabled)";
            notifPerms = 1;
          } else if (permission == "denied"){
            console.log("Notification permissions denied");
            document.getElementById("notifstatus").innerText = "(Notification access denied! Please enable notifications)";
          } else {
            console.log("Notifications not supported");
            document.getElementById("notifstatus").innerText = "(Your browser does not support notifications)";
          }
        }
        );
      } else {
        console.log("Notifications disabled");
        document.getElementById("notifstatus").innerText = "(Notifications disabled)";
      }
      
    }
    var jaspercrystal = 0;
    var rubycrystal = 0;
    var opalcrystal = 0;
    var aquamarinecrystal = 0;
    var peridotcrystal = 0;
    var onyxcrystal = 0;
    var citrinecrystal = 0;
    function toggleJasper () {
      jaspercrystal = Math.abs(jaspercrystal - 1);
      if (jaspercrystal == 1) {
        weights_vanguard["jasper_crystal"] = 0;
        weights_metal["jasper_crystal"] = 0;
        //weights_tungsten["jasper_crystal"] = 0;
      } else {
        weights_vanguard["jasper_crystal"] = 50;
        weights_metal["jasper_crystal"] = 50;
        //weights_tungsten["jasper_crystal"] = 50;
      }
      updateCorpses();
    }
    function toggleRuby () {
      rubycrystal = Math.abs(rubycrystal - 1);
      if (rubycrystal == 1) {
        weights_vanguard["ruby_crystal"] = 0;
        weights_metal["ruby_crystal"] = 0;
        //weights_tungsten["ruby_crystal"] = 0;
      } else {
        weights_vanguard["ruby_crystal"] = 50;
        weights_metal["ruby_crystal"] = 50;
        //weights_tungsten["ruby_crystal"] = 50;
      }
      updateCorpses();
    }
    function toggleOpal () {
      opalcrystal = Math.abs(opalcrystal - 1);
      if (opalcrystal == 1) {
        weights_vanguard["opal_crystal"] = 0;
        weights_metal["opal_crystal"] = 0;
        //weights_tungsten["opal_crystal"] = 0;
      } else {
        weights_vanguard["opal_crystal"] = 50;
        weights_metal["opal_crystal"] = 50;
        //weights_tungsten["opal_crystal"] = 50;
      }
      updateCorpses();
    }
    function toggleAqua () {
      aquamarinecrystal = Math.abs(aquamarinecrystal - 1);
      if (aquamarinecrystal == 1) {
        weights_vanguard["aquamarine_crystal"] = 0;
        weights_metal["aquamarine_crystal"] = 0;
        //weights_tungsten["aquamarine_crystal"] = 0;
      } else {
        weights_vanguard["aquamarine_crystal"] = 50;
        weights_metal["aquamarine_crystal"] = 50;
        //weights_tungsten["aquamarine_crystal"] = 50;
      }
      updateCorpses();
    }
    function togglePeridot () {
      peridotcrystal = Math.abs(peridotcrystal - 1);
      if (peridotcrystal == 1) {
        weights_vanguard["peridot_crystal"] = 0;
        weights_metal["peridot_crystal"] = 0;
        //weights_tungsten["peridot_crystal"] = 0;
      } else {
        weights_vanguard["peridot_crystal"] = 50;
        weights_metal["peridot_crystal"] = 50;
        //weights_tungsten["peridot_crystal"] = 50;
      }
      updateCorpses();
    }
    function toggleOnyx () {
      onyxcrystal = Math.abs(onyxcrystal - 1);
      if (onyxcrystal == 1) {
        weights_vanguard["onyx_crystal"] = 0;
        weights_metal["onyx_crystal"] = 0;
        //weights_tungsten["onyx_crystal"] = 0;
      } else {
        weights_vanguard["onyx_crystal"] = 50;
        weights_metal["onyx_crystal"] = 50;
        //weights_tungsten["onyx_crystal"] = 50;
      }
      updateCorpses();
    }
    function toggleCitrine () {
      citrinecrystal = Math.abs(citrinecrystal - 1);
      if (citrinecrystal == 1) {
        weights_vanguard["citrine_crystal"] = 0;
        weights_metal["citrine_crystal"] = 0;
        //weights_tungsten["citrine_crystal"] = 0;
      } else {
        weights_vanguard["citrine_crystal"] = 50;
        weights_metal["citrine_crystal"] = 50;
        //weights_tungsten["citrine_crystal"] = 50;
      }
      updateCorpses();
    }
    function updateCorpses() {
      if (gftd.value > 101){
          document.getElementById("gftd").value = 101;
      }
      if (gftd.value < 0 || isNaN(gftd.value) || gftd.value == ""){
          document.getElementById("gftd").value = 0;
      }
      corpsetable.innerHTML = "";
      var loottable = eval(`weights_${corpsetype.value}`);
      var loottranslations = eval(`translations_${corpsetype.value}`);
      console.log(loottable);
      var totalweight = 0;
        for (var key2 in loottable) {
            totalweight += loottable[key2];
        }

        /*
        var rolls5 = binomial(5, (3/totalweight), 1);
        var rolls6 = binomial(6, (3/totalweight), 1);
        var rolls7 = binomial(7, (3/totalweight), 1);
        var rolls8 = binomial(8, (3/totalweight), 1);
        var rolls9 = binomial(9, (3/totalweight), 1);
        */
        //console.log("Locket chance: " + (100 * ((0.2 * rolls5) + (0.25 * rolls6) + (0.25 * rolls7) + (0.25 * rolls8) + (0.05 * rolls9))).toFixed(3) + "%");
        for (var key2 in loottable) {
            var tablerow = document.createElement("tr");
            tablerow.style.width = "100%"
            var itemname = document.createElement("td");
            itemname.style.paddingRight = "20px";
            itemname.innerText = loottranslations[key2] + ":";
            var itemchance = document.createElement("td");
            itemchance.style.paddingRight = "20px";
            itemchance.style.textAlign = "right";
            if (corpsetype.value == "vanguard"){
              itemchance.innerText = (100 * (((0.2 + ((100 - gftd.value) * 0.0005)) * binomial(5, (loottable[key2]/totalweight), 1)) + (0.25 * binomial(6, (loottable[key2]/totalweight), 1)) + (0.25 * binomial(7, (loottable[key2]/totalweight), 1)) + (0.25 * binomial(8, (loottable[key2]/totalweight), 1)) + (((gftd.value) * 0.0005) * binomial(9, (loottable[key2]/totalweight), 1)))).toFixed(3) + "%";
            } else if (corpsetype.value = "metal") {
              itemchance.innerText = (100 * (((0.2 + ((100 - gftd.value) * 0.0005)) * binomial(4, (loottable[key2]/totalweight), 1)) + (0.25 * binomial(5, (loottable[key2]/totalweight), 1)) + (0.25 * binomial(6, (loottable[key2]/totalweight), 1)) + (0.25 * binomial(7, (loottable[key2]/totalweight), 1)) + (((gftd.value) * 0.0005) * binomial(8, (loottable[key2]/totalweight), 1)))).toFixed(3) + "%";
            }
            
            tablerow.appendChild(itemname);
            tablerow.appendChild(itemchance);
            corpsetable.appendChild(tablerow);
        }
      }
  </script>
  </html>
  