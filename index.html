<!DOCTYPE html>
  <html lang = "en">
  <head>
    <meta name = "description" content = "Various utilities for Hypixel SkyBlock">
    <meta name = "author" content = "adjective_n0un">
    <meta name="viewport" content="width=device-width, initial-scale=0.5">
    <title>adjectils - Home</title>
    <link rel="stylesheet" href="stylesheet.css">
  
    <link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
    <link rel="manifest" href="./favicon/site.webmanifest">
    <script src = "timeToMinutes.js"></script>
  </head>
  <body onload="updatePage()">
  
  <script type="text/javascript" src="/jquery-3.6.3.min.js"></script>
      <script>
      $(function(){
        $("#nav").load("nav.html", function() { setWord(); }); 
      });
      </script>
  
  <div id = header style = "text-align: center; margin: 20px">
  <a href = "index.html" class = adjheader>adjectils</a><span class = header>&nbsp;|&nbsp;</span><span class = header>Home</span><br>
  <span class = "splash" id = "splashtext"></span>
  </div>
  <section class = "flex_box_index">
    <div class = "flex_index_row" style = "width:95%;height:50%; align-items: stretch;">
      <div class = "flex_index_box" style = "width: 64%" id = "election">
        <div style = "flex-basis: 100%">
          <span class = "indexheader">Current mayor:&nbsp;</span><span class = "indexheader" id = "currentmayor"></span><br>
        </div>
        <table id = "electiontable">

        </table>
      </div>
      <div class = "flex_index_box" style = "width: 34%; flex:1" id = "datetime">
        <div style = "display:flex; flex-basis:100%; justify-content:flex-end;">
          <span class = "indexheader" id = "sbmonth"></span><span class = "indexheader">&nbsp;</span><span class = "indexheader" id = "sbseason"></span><span class = "indexheader">&nbsp;</span><span class = "indexheader" id = "sbdate"></span>
        </div>
        <div style = "display:flex; flex-basis:100%; justify-content:flex-end;">
          <span style = "font-size: 20px;">Year&nbsp;</span><span style = "font-size:20px" id = sbyear></span>
        </div>
        <div style = "display:flex;flex-basis:100%; justify-content:flex-end;">
          <span id = "sbtime"></span>
        </div>
        <div style = "display:flex; flex-basis:100%; height:70%"></div>
      </div>
    </div>
    <div class = "flex_index_row" style = "width:95%; height:20%;">
    <div class = "flex_index_box" style = "width: 100%; height:70%;" id = "">
      <div style = "display:flex;flex-basis:100%;">
        <span class = header style = "margin-bottom: 20px;">Annual Events</span>
      </div>
      <div style = "display:flex;flex-basis: min(calc(100% - 30px), max(600px, 65%));">
      <span style = "margin-right:20px">Allow event notifications</span>
      <div>

        <label class = "switchbox" id = "notifyswitch" for = "notify">
          <input type = "checkbox"  id = "notify" onchange = toggleEventNotif() aria-labelledby = "notifyswitch" style = "opacity:0">
          <span class = "switch"></span>
        </label>
      </div>
      <div>
      </div>
      </div>
      <div class = "flex_full_row">
        <span id = "notifstatus">(Notifications disabled)</span>
      </div>
      <div class = "flex_full_row">
        <div>
          <form action = "#" id = "notificationtime">
            <label for = "notificationtime">Notify me
            <select id = "notibefore">
              <option value = 60>1</option>
              <option value = 180>3</option>
              <option value = 300>5</option>
              <option value = 600>10</option>
              <option value = 900>15</option>
              <option value = 1200>20</option>
              <option value = 1800>30</option>
              <option value = 2700>45</option>
              <option value = 3600>60</option>
            </select>
            minutes before event.</label>
          </form>
        </div>
      </div>
      <table id = "eventtable" style = "flex-basis: min(calc(100% - 30px), max(960px, 90%));">  
        
      </table>
      <div style = "display:flex;flex-basis:100%; margin-top: 10px;">
        <span class = header style = "margin-bottom: 20px;">Recurring events</span>
      </div>
      
      <span class = "flex_full_row">Time until next&nbsp;<span style = "color:#aa00aa">Dark Auction</span>:&nbsp;<span id = "datime"></span></span>
      <div class = "flex_full_row">
        <form action = "#" id = "danotifs">
          <div class = "flex_full_row">
          <span style = "margin-right:20px">Notify me when <span style = "color:#aa00aa">Dark Auction</span> starts.</span>
            <label class = "switchbox" id = "daswitch" for = "danotif">
              <input type = "checkbox"  id = "danotif" aria-labelledby = "daswitch" style = "opacity:0">
              <span class = "switch"></span>
            </label>
          </div>
          
          <label for = "danotibefore">Notify me
          <select id = "danotibefore">
            <option value = 60>1</option>
            <option value = 120>2</option>
            <option value = 180>3</option>
            <option value = 240>4</option>
            <option value = 300>5</option>
          </select>
          minutes before <span style = "color: #aa00aa">Dark Auction</span>.</label>
        </form> 
      </div>
      <span class = "flex_full_row">Time until next&nbsp;<span style = "color:#ffff55">Jacob's Farming Contest</span>:&nbsp;<span id = "jacobtime"></span></span>
      <div class = "flex_full_row">
        
        <form action = "#" id = "jacobnotifs">
          <div class = "flex_full_row">
            <span style = "margin-right:20px">Notify me when <span style = "color:#ffff55">Jacob's Farming Contest</span> starts.</span>
              <label class = "switchbox" id = "jacobswitch" for = "jacobnotif">
                <input type = "checkbox"  id = "jacobnotif" aria-labelledby = "jacobswitch" style = "opacity:0">
                <span class = "switch"></span>
              </label>
            </div>
            
          <label for = "jacobnotibefore">Notify me
          <select id = "jacobnotibefore">
            <option value = 60>1</option>
            <option value = 120>2</option>
            <option value = 180>3</option>
            <option value = 240>4</option>
            <option value = 300>5</option>
            
          </select>
          minutes before <span style = "color: #ffff55">Jacob's Farming Contest</span>.</label>
        </form> 
      </div>
      <span class = "flex_full_row">Time until next&nbsp;<span style = "color:#22aaaa">Fallen Star Cult meeting</span>:&nbsp;<span id = "startime"> (Coming soon)</span></span>
      <div class = "flex_full_row">
        
        <form action = "#" id = "starnotifs">
          <div class = "flex_full_row">
            <span style = "margin-right:20px">Notify me when the <span style = "color:#22aaaa">Cult of the Fallen Star</span> meets.</span>
              <label class = "switchbox" id = "starswitch" for = "starnotif">
                <input type = "checkbox"  id = "starnotif" aria-labelledby = "starswitch" style = "opacity:0">
                <span class = "switch"></span>
              </label>
            </div>
            
          <label for = "starnotibefore">Notify me
          <select id = "starnotibefore">
            <option value = 60>1</option>
            <option value = 120>2</option>
            <option value = 180>3</option>
            <option value = 240>4</option>
            <option value = 300>5</option>
            
          </select>
          minutes before <span style = "color: #22aaaa">Fallen Star Cult meetings</span>.</label>
        </form> 
      </div>
      <div style = "padding-top: 20px;">
        <span class = "header flex_full_row" style = "padding-bottom: 20px;">Special Events</span>
        <label  class = "flex_full_row" for = "eventmayor" style = "padding-bottom: 20px;" onchange = "generateSchedule()">Mayor: 
          <select id = "eventmayor" style = "margin-right: 20px;">
            <option value = "0">Other</option>
            <option value = "Marina">Marina</option>
            <option value = "Diaz">Diaz</option>
            <option value = "Cole">Cole</option>
            
          </select></label>
        <span class = hovertext onclick = "generateSchedule()" id = "hideme" hidden = true>Click to generate schedule...</span>
        <span class = "flex_full_row" style = "margin-right:20px;">Notify me when Mayor events start.
            <label class = "switchbox" id = "eventswitch" for = "specnotif" style = "margin-left: 10px;">
              <input type = "checkbox"  id = "specnotif" aria-labelledby = "eventswitch" style = "opacity:0">
              <span class = "switch"></span>
            </label>
            </span>
            <label class = "flex_full_row" for = "specnotibefore" style = "padding-bottom:20px;">Notify me
              <select id = "specnotibefore" style = "margin-left: 10px; margin-right: 10px">
                <option value = 60>1</option>
                <option value = 120>2</option>
                <option value = 180>3</option>
                <option value = 240>4</option>
                <option value = 300>5</option>
              </select>
              minutes before Mayor Events.</label>
        <table id = "schedulebox" style = "width:100%">


        </table>
        <span id = "nothingtoseehere" hidden = true>No events for this mayor...</span>
        <span id = "nothingtoseehere2" hidden = true>No more events for this mayor...</span>
      </div>
    </div>
    </div>
    <div class = "flex_index_row" style = "width:95%; height:20%;">
    <div class = "flex_index_box" style = "width: 100%; height:70%;" id = "">
      <span class = header style = "flex-basis:100%">Election</span>
      <table id = "electiontable2case" class = "flex_full_row">
        <tbody id = "electiontable2" style = "width:90%">

        </tbody>
      </table>
      <span style = "color: #808080">Next <span style = "color: #ff55ff">special</span> mayor: <span id = "specialmayorname"></span> in <span id = "specialmayortime"></span></span>
    </div>
    </div>
  </div>
</section>
<br>
  <div id = "nav" style = "width:min(83.3%, 600px); margin: auto;" class = "hub_block"></div>
  </body>
  <script>
    var date = new Date();
    var timeofday = "morning";
    if (date.getHours() < 5 && date.getHours() > -1){
      timeofday = "night";
    }
    if (date.getHours() < 20 && date.getHours() > 12){
      timeofday = "afternoon";
    }
    if (date.getHours() < 24 && date.getHours() > 19){
      timeofday = "evening";
    }
    var splashes_morning = ["Since 2024!", "BrookeAFK helped a lot!", "Also play Warlords!", "Distributing binomials!", "Also visit nadeshiko.io!", "Stalking the API!", "NOT playing Skywars!", "Now with 100% more bugs!", "<o/", "Glad you made it!", "0.02% less sugar!", "Entertaining splash texts!", "Coming soon!", "Rise and shine!", "Wait up!", "Finally awake?", "Destiny awaits!", "What do you want to be?", "Greatness begins here!", "Planned everything out?", "Stay alert!", "The early runner gets the loot!", "Wake-up call!", "Another day!"];
    var splashes_afternoon = ["Great weather today!", "Overkill!", "BrookeAFK helped a lot!", "Just add water!", "Alpha tested!", "Admin endorsed!", "About 99% truthful!", "Ok, but when do we get the wave text?", "Not contradictory!", "Side effects include being awesome!", "May cause headaches!", "Ad-free!", "Life-changing!", "Optimized!", "How about a break?", "Meant to be!", "Best of three?", "Heart and soul!", "Reason enough!", "Sudden!", "https://adjectiven0un.github.io/holeinthewall ?", "Tap here to do absolutely nothing!", "Geronimo!", "Until we see the end of time!", "High intensity discharge!"];
    var splashes_evening = ["Better call Paul!", "BrookeAFK helped a lot!", "Can we make that a splash?", "Toasting marshmallows!", "Are we there yet?", "As seen on TV!", "Welcome back!", "Keep calm!", "Not scary!", "Regenerative!", "Treats boredom!", "Brevity!", "Written in notepad!", "Best viewed by candlelight!", "Hello, world?", "Plundering!", "Foraging when?", "Cross my heart and hope to die!", "Watch your step!", "Full of secrets!", "Avoid direct contact!", "But if you close your eyes...", "Your biggest fan!", "Pit reference!", "Into the unknown!"];
    var splashes_night = ["Time for bed, perhaps?", "BrookeAFK helped a lot!", "Burning the midnight oil!", "The stars don't shine as bright as you!", "And don't be afraid of the dark!", "Don't do hacks!", "Full of easter eggs!", "Satiable hunger!", "Suitable for all ages!", "Updated in 3-5 business days!", "Now in dark theme!", "How many of these are there?", "Three's a crowd!", "Two nights until the Coven have the Necronomicon!", "Watch the doors!", "Once upon a midnight dreary...", "NIGHT QUEST! Kill 50 players!", "Tranquil, isn't it?", "No holding back!", "A push in the right direction!", "It was here all along!", "Toil and trouble!", "A light in the sky!", "Time after time!", "Ready, aim, fire!"];
    const daylen = 1200;
    const monthlen = 31 * daylen;
    const seasonlen = 3 * monthlen;
    const yearlen = 4 * seasonlen;
    const tenstep = daylen / (6 * 24);
    const seasons = ["Spring", "Summer", "Autumn", "Winter"];
    const monthlist = ["Early", "", "Late"];
    var initial = 1560275700;
    var currenttime = (Date.now() / 1000);
    var yearcycletime = (currenttime - initial) % yearlen;
    var eventNotifs = 0;
    var notifPerms = 0;
    function toggleEventNotif(){
      eventNotifs = Math.abs(eventNotifs - 1);
      if (eventNotifs == 1){
        Notification.requestPermission().then(
        function(permission){
          if (permission == "granted"){
            console.log("Notifications enabled");
            document.getElementById("notifstatus").innerText = "(Notifications enabled)";
            notifPerms = 1;
          } else if (permission == "denied"){
            console.log("Notification permissions denied");
            document.getElementById("notifstatus").innerText = "(Notification access denied! Please enable notifications)";
          } else {
            console.log("Notifications not supported");
            document.getElementById("notifstatus").innerText = "(Your browser does not support notifications)";
          }
        }
        );
      } else {
        console.log("Notifications disabled");
        document.getElementById("notifstatus").innerText = "(Notifications disabled)";
      }
      
    }
    async function updatePage(){

        document.getElementById("notify").checked = false;
        document.getElementById("danotif").checked = false;
        document.getElementById("jacobnotif").checked = false;
        document.getElementById("starnotif").checked = false;
        var splashindex = Math.floor(25 * Math.random());
        document.getElementById("splashtext").innerText = eval("splashes_" + timeofday)[splashindex];
        updateDate();
        updateEvents();
        
        setInterval(updateDate, 4167);
        setInterval(updateEvents, 1000);
        setInterval(updateHourlies, 1000);
        try {
          const apicall = await fetch("https://api.hypixel.net/resources/skyblock/election");
          if (!apicall.ok){
            console.log("Api call error");
            //document.getElementById("status").innerHTML = "<span class = errored>API error - come back later</span>";
            return -1;
          }
          const mayordata = await apicall.json();
          var currentmayor = mayordata.mayor.name;
          document.getElementById("currentmayor").innerText = currentmayor;
          eventmayor.value = currentmayor;
          for (var i = 0; i < mayordata.mayor.perks.length; i++){
            var perk = document.createElement("span");
            perk.textContent = mayordata.mayor.perks[i].name + ": " + mayordata.mayor.perks[i].description.replace(/ยง./g, "") + "\n";
            perk.style.display = "flex";
            perk.style.flexBasis = "100%";
            var electiontd = document.createElement("td");
            electiontd.appendChild(perk);
            var electiontr = document.createElement("tr");
            electiontr.style.display = "flex";
            electiontr.style.flexBasis = "100%";
            electiontr.appendChild(electiontd);
            electiontable.appendChild(electiontr);
          }
          
          
        } catch (NetworkError){
          document.getElementById("currentmayor").innerText = "Couldn't connect to API!";
          console.log("Couldn't find the current mayor! Is the API down?");
        }
        try {
          var timer = document.createElement("div");
          timer.style.display = "flex";
          timer.style.flexBasis = "100%";
          var text = document.createElement("span");
        } catch (Error) {
          console.log("Error making timer...");
        }
        try {
          const apicall = await fetch("https://api.hypixel.net/resources/skyblock/election");
          if (!apicall.ok){
            console.log("Api call error");
            //document.getElementById("status").innerHTML = "<span class = errored>API error - come back later</span>";
            return -1;
          }
          const mayordata = await apicall.json();
          const curdata = mayordata.current;
          var mayornames = ["", "", "", "", ""];
          var votes = ["", "", "", "", ""];
          var indexswaps = ["0", "1", "2", "3", "4"];
          for (var i = 0; i < 5; i++){
            mayornames[i] = curdata.candidates[i].name;
            votes[i] = curdata.candidates[i].votes;
          }
          for (var i = 1; i < 5; i++){
             var key1 = votes[i];
             var key2 = mayornames[i];
             var key3 = indexswaps[i];
             var j = i - 1;
             while (j >= 0 && votes[j] < key1){
              votes[j + 1] = votes[j];
              mayornames[j + 1] = mayornames[j];
              indexswaps[j + 1] = indexswaps[j];
              j--;
             }
             votes[j + 1] = key1;
             mayornames[j + 1] = key2;
             indexswaps[j + 1] = key3;
          }
          var votespercent = ["", "", "", "", ""];
          var votestotal = 0;
          for (var i = 0; i < 5; i++){
            votestotal += votes[i];
          }
          for (var i = 0; i < 5; i++){
            votespercent[i] = (100 * (votes[i] / votestotal)).toFixed(1);
          }
          for (var i = 0; i < 5; i++){
            var mayorrow1 = document.createElement("tr");
            mayorrow1.style.width = "100%";
            mayorrow1.className = "flex_full_row";
            var mayorname = document.createElement("td");
            mayorname.style.fontSize = "20px";
            mayorname.innerText = mayornames[i];
            mayorname.style.width = "15%";
            mayorrow1.style.borderBottom = "2px solid #c0c0c0";
            mayorrow1.style.marginTop = "2%";
            mayorrow1.style.marginBottom = "2%";
            mayorrow1.appendChild(mayorname);
            var mayorvotes = document.createElement("td");
            mayorvotes.style.fontSize = "20px";
            mayorvotes.innerText = votes[i].toLocaleString() + " votes ";
            mayorvotes.style.width = "20%";
            mayorvotes.style.textAlign = "right";
            mayorrow1.appendChild(mayorvotes);
            var mayorpercent = document.createElement("td");
            mayorpercent.style.fontSize = "20px";
            mayorpercent.innerText = votespercent[i] + "%";
            mayorpercent.style.width = "20%";
            mayorpercent.style.textAlign = "right";
            mayorrow1.appendChild(mayorpercent);
            var mayorperktable = document.createElement("table");
            mayorperktable.style.width = "90%";
            for (var j = 0; j < curdata.candidates[indexswaps[i]].perks.length; j++){
              var perkrow1 = document.createElement("tr");
              perkrow1.style.width = "90%";
              var perktd1 = document.createElement("td");
              perktd1.style.width = "25%";
              perktd1.style.paddingRight = "20px";
              var perktd2 = document.createElement("td");
              perktd1.innerText = curdata.candidates[indexswaps[i]].perks[j].name;
              perktd2.innerText = curdata.candidates[indexswaps[i]].perks[j].description.replace(/ยง./g, "") + "\n";
              perkrow1.appendChild(perktd1);
              perkrow1.appendChild(perktd2);
              mayorperktable.appendChild(perkrow1);
            }
            electiontable2.appendChild(mayorrow1);
            var mayorrow2 = document.createElement("tr");
            var mayortd2 = document.createElement("td");
            mayortd2.appendChild(mayorperktable);
            mayorrow2.appendChild(mayortd2);
            mayorrow2.className = "flex_full_row";
            electiontable2.appendChild(mayorrow2);
            
          }
          
        } catch (TypeError){
          console.log("Mayor election is not on right now");
          var mayorrow = document.createElement("tr");
          var mayortd = document.createElement("td");
          var mayorname= document.createElement("div");
          mayorname.style.fontSize = "16px";
          mayorname.style.flexBasis = "100%";
          mayorname.innerText = "The election booth is closed right now. Come back later!";
          mayortd.appendChild(mayorname);
          mayorrow.appendChild(mayortd);
          electiontable2.appendChild(mayorrow);
        }
        generateSchedule();
        
    }
    var year = 0;
    function updateDate(){
        currenttime = Math.floor(Date.now() / 1000);
        year = Math.floor((currenttime - initial) / yearlen);
        document.getElementById("sbyear").innerText = year + 1;
        var yearcycletime = (currenttime - initial) % yearlen;
        var season = seasons[Math.floor(yearcycletime / seasonlen)];
        document.getElementById("sbseason").innerText = season;
        var seasoncycletime = (yearcycletime) % seasonlen;
        var month = monthlist[Math.floor(seasoncycletime / monthlen)];
        document.getElementById("sbmonth").innerText = month;
        var monthcycletime = (seasoncycletime) % monthlen;
        var day = Math.floor(monthcycletime / daylen) + 1;
        if (day % 10 == 1 && day != 11) {
          document.getElementById("sbdate").innerText = day + "st";
        } else if (day % 10 == 2 && day != 12) {
          document.getElementById("sbdate").innerText = day + "nd";
        } else if (day % 10 == 3 && day != 13) {
          document.getElementById("sbdate").innerText = day + "rd";
        } else {
          document.getElementById("sbdate").innerText = day + "th";
        }
        var daycycletime = (monthcycletime) % daylen;
        var segments = Math.floor(daycycletime / tenstep);
        var minutes = segments % 6 + "0";
        var hours = Math.floor(segments / 6);
        var ampm = "am";
        if (hours > 12){
          hours -= 12;
          ampm = "pm";
        }
        if (hours == 0) {
          hours = 12;
        }
        document.getElementById("sbtime").innerText = hours + ":" + minutes + ampm;
    }
    var eventColors = {
        "hoppity": "#c64fbd",
        "electionClose": "#55ffff",
        "zoo1": "#55ff55",
        "electionOpen": "#55ffff",
        "spooky": "#ffaa00",
        "zoo2": "#55ff55",
        "winter": "#ff5555",
        "jerry": "#ff0000",
        "newyear": "#ff55ff",
    }
    var eventNames = {
        "hoppity": "Hoppity's Hunt",
        "electionClose": "Election finalized",
        "zoo1": "Traveling Zoo #1",
        "electionOpen": "Election starts",
        "spooky": "Spooky Festival",
        "zoo2": "Traveling Zoo #2",
        "winter": "Winter Island",
        "jerry": "Season of Jerry",
        "newyear": "New Year Celebration",
    }
    var notifPermsByEvent = {
      "hoppity": 0,
        "electionClose": 0,
        "zoo1": 0,
        "electionOpen": 0,
        "spooky": 0,
        "zoo2": 0,
        "winter": 0,
        "jerry": 0,
        "newyear": 0,
    }
    var previndex = -1;
    function updateEvents(){
      var initial = 1560275700;
      var now = Math.floor(Date.now() / 1000); 
      var yearcycletime = (now - initial) % yearlen;
      var indices = ["hoppity", "electionClose", "zoo1", "electionOpen",  "spooky", "zoo2", "winter", "jerry", "newyear"];
      var timeUntil = {
        "hoppity": yearlen - yearcycletime,
        "electionClose": (yearlen + (2 * monthlen + 26 * daylen) - yearcycletime) % yearlen,
        "zoo1": (yearlen + (seasonlen) - yearcycletime) % yearlen,
        "electionOpen": (yearlen + (5 * monthlen + 26 * daylen) - yearcycletime) % yearlen,
        "spooky": (yearlen + (7 * monthlen + 28 * daylen) - yearcycletime) % yearlen,
        "zoo2": (yearlen + (3 * seasonlen) - yearcycletime) % yearlen, 
        "winter": (yearlen + (3 * seasonlen + 2 * monthlen) - yearcycletime) % yearlen,
        "jerry": (yearlen + (3 * seasonlen + 2 * monthlen + 23 * daylen) - yearcycletime) % yearlen,
        "newyear": (yearlen + (3 * seasonlen + 2 * monthlen + 28 * daylen) - yearcycletime) % yearlen,
    }
      var startindex;
      for (var i = 0; i < 9; i++){
        if (timeUntil[indices[i]] > timeUntil[indices[(i + 1) % 9]]){
          startindex = (i + 1) % 9;
        }
      }
      if (startindex != previndex){
        previndex = startindex;
        for (var i = startindex; i < startindex + 9; i++){
          if (document.getElementById(indices[(i) % 9] + "row") != undefined){
            eventtable.removeChild(document.getElementById(indices[i % 9] + "row"));
          }
          var row = document.createElement("tr");
          row.id = indices[i % 9] + "row";
          row.style.justifyContent = "space-evenly";
          row.style.width = "80%";
          var data1 = document.createElement("td");
          var namediv = document.createElement("div");
          
          namediv.style.display = "flex";
          namediv.style.flexBasis = "100%";
          namediv.style.width = "100%";
          var evname = document.createElement("span");
          evname.style = "color: " + eventColors[indices[i % 9]];
          evname.textContent = eventNames[indices[i % 9]] + ":";
          namediv.appendChild(evname);
          data1.appendChild(namediv);
          row.appendChild(data1);
          
          var data2 = document.createElement("td");
          var timediv = document.createElement("div");
          timediv.style.display = "flex";
          timediv.style.flexBasis = "100%";
          timediv.style.justifyContent = "flex-end";
          timediv.style.paddingRight = "10%";
          var evtime = document.createElement("span");
          evtime.textContent = "e";
          evtime.id = indices[i % 9] + "time";
          timediv.appendChild(evtime);
          data2.appendChild(timediv);
          row.appendChild(data2);
          
          var data3 = document.createElement("td");
          var datediv = document.createElement("div");
          datediv.style.display = "flex";
          datediv.style.flexBasis = "100%";
          datediv.style.justifyContent = "flex-end";
          var datespan = document.createElement("span");
          datespan.textContent = "e";
          datespan.id = indices[i % 9] + "date";
          datediv.appendChild(datespan);
          data3.appendChild(datediv);
          row.appendChild(data3);
          

          var data4 = document.createElement("td");
          var notifydiv = document.createElement("div");
          notifydiv.style.display = "flex";
          notifydiv.style.flexBasis = "100%";
          notifydiv.style.justifyContent = "flex-end";
          notifydiv.style.paddingRight = "10%";
          var label = document.createElement("span");
          label.textContent = "Notify me";
          label.style.marginRight = "20px";
          notifydiv.appendChild(label);
          var switchlabel = document.createElement("label");
          switchlabel.className = "switchbox";
          var switchcheck = document.createElement("input");
          switchcheck.type = "checkbox";
          switchcheck.id = indices[i % 9] + "switch";
          let name = indices[i % 9];
          switchcheck.onchange = function() {
            updatePerms(name);
          };
          var switchspan = document.createElement("span");
          switchspan.className = "switch";
          switchlabel.appendChild(switchcheck);
          switchlabel.appendChild(switchspan);
          notifydiv.appendChild(switchlabel);
          data4.appendChild(notifydiv);
          row.appendChild(data4);

          eventtable.appendChild(row);
        }
      }
      setEventTimer("hoppity", timeUntil["hoppity"], seasonlen);
      setEventTimer("electionOpen", timeUntil["electionOpen"], 0);
      setEventTimer("electionClose", timeUntil["electionClose"], 0);
      setEventTimer("spooky", timeUntil["spooky"], 3 * daylen);
      setEventTimer("winter", timeUntil["winter"], monthlen);
      setEventTimer("jerry", timeUntil["jerry"], 3 * daylen);
      setEventTimer("newyear", timeUntil["newyear"], 3 * daylen);
      setEventTimer("zoo1", timeUntil["zoo1"], 3 * daylen);
      setEventTimer("zoo2", timeUntil["zoo2"], 3 * daylen);
    }
    function setEventTimer(elementname, timer, eventDuration){
      if (timer > yearlen - eventDuration){
        document.getElementById(elementname + "time").innerText = "Active for " + timeToMinutes(timer - (yearlen - eventDuration));
        var current = Math.floor(Date.now() / 1000);
        var endtime = Math.floor(current - yearlen + timer + eventDuration);
        document.getElementById(elementname + "date").innerText = "Until " + convertTimestamp(endtime);
      } else {
        document.getElementById(elementname + "time").innerText = timeToMinutes(timer);
        var current = Math.floor(Date.now() / 1000);
        var eventtime = Math.floor(current + timer);
        document.getElementById(elementname + "date").innerText = "@ " + convertTimestamp(eventtime);
        if (timer == notibefore.value && eventNotifs == 1 && notifPerms == 1 && notifPermsByEvent[elementname] == 1){
          var mingrammar = "minutes";
          if (notibefore.value == 60){
            mingrammar = "minute";
          }
          var notification = new Notification("adjectils", {body: eventNames[elementname] + " begins in " + Math.floor(notibefore.value/60) + " " + mingrammar, icon: "./favicon/favicon.ico"});
        }
      }
    }
    function updatePerms(elementname){
      notifPermsByEvent[elementname] = Math.abs(notifPermsByEvent[elementname] - 1);
    }
    function updateHourlies(){
      var initial = 1560275700;
      var now = Math.floor(Date.now() / 1000); 
      var hourcycletime = (now - initial) % 3600;
      var timetojacob = Math.abs((4800 - hourcycletime) % 3600);
      jacobtime.innerText = timeToMinutes(timetojacob);
      var timetoda = Math.abs((3600 - hourcycletime) % 3600);
      datime.innerText = timeToMinutes(timetoda);
      var monthcycletime = (now - initial) % monthlen;
      var timetomonthend = Math.abs((monthlen - monthcycletime) % monthlen);
      var possiblestartimes = [timetomonthend - (4 * daylen), timetomonthend - (11 * daylen), timetomonthend - (18 * daylen), timetomonthend - (25 * daylen)];
      var timetostar = 31 * daylen;
      for (let i = 0; i <= possiblestartimes.length; i++) {
        console.log("time: " + possiblestartimes[i]);
        if (possiblestartimes[i] < timetostar && possiblestartimes[i] >= 0) {
          timetostar = possiblestartimes[i];
        }
      }
      startime.innerText = timeToMinutes(timetostar);
      //console.log("DA time: " + timetoda + " EVN: " + eventNotifs + " NP: " + notifPerms + " CN: " + danotif.checked);
      if (timetoda == danotibefore.value && danotif.checked == true){
          var mingrammar = "minutes";
          if (danotibefore.value == 60){
            mingrammar = "minute";
          }
        var notification = new Notification("adjectils",  {body: "Dark Auction begins in " + Math.floor(danotibefore.value/60) + " " + mingrammar, icon: "./favicon/favicon.ico"});
      }
      if (timetojacob == jacobnotibefore.value && jacobnotif.checked == true){
          var mingrammar = "minutes";
          if (jacobnotibefore.value == 60){
            mingrammar = "minute";
          }
        var notification = new Notification("adjectils",  {body: "Jacob's Farming Contest begins in " + Math.floor(jacobnotibefore.value/60) + " " + mingrammar, icon: "./favicon/favicon.ico"});
      }
      if (timetostar == starnotibefore.value && starnotif.checked == true){
          var mingrammar = "minutes";
          if (starnotibefore.value == 60){
            mingrammar = "minute";
          }
        var notification = new Notification("adjectils",  {body: "Fallen Star Cult meets in " + Math.floor(danotibefore.value/60) + " " + mingrammar, icon: "./favicon/favicon.ico"});
      }
      var specialcycletime = (now - initial) % (24 * 446400);
      var timetoscorpius = -((specialcycletime - (24 * 446400) - 2 * monthlen - 27 * daylen) % (24 * 446400));
      var timetoderpy = -((specialcycletime - (8 * 446400) - 2 * monthlen - 27 * daylen) % (24 * 446400));
      var timetojerry = -((specialcycletime - (16 * 446400) - 2 * monthlen - 27 * daylen) % (24 * 446400));
      if (timetoscorpius <= 0) {
        timetoscorpius = 2100000000;
      }
      if (timetoderpy <= 0) {
        timetoderpy = 2100000000;
      }
      if (timetojerry <= 0) {
        timetojerry = 2100000000;
      }
      var timetospecial = Math.floor(Math.min(timetoscorpius, Math.min(timetoderpy, timetojerry)));
      if (timetospecial == Math.floor(timetoscorpius)) {
        document.getElementById("specialmayorname").innerText = "Scorpius";
      }
      if (timetospecial == Math.floor(timetoderpy)) {
        document.getElementById("specialmayorname").innerText = "Derpy";
      }
      if (timetospecial == Math.floor(timetojerry)) {
        document.getElementById("specialmayorname").innerText = "Jerry";
      }
      
      document.getElementById("specialmayortime").innerText = betterTimestamp(timetospecial);
    }
    var times = [];
    var activemayor = "none";
    var eventname = "";
    var targetyear = "";
    function generateSchedule() {
      clearInterval(events2interval);
      nothingtoseehere.hidden = true;
      nothingtoseehere2.hidden = true;
      schedulebox.innerHTML = "";
      schedulebox.hidden = false;
      hideme.hidden = "true";
      if (eventmayor.value == 0 && activemayor == "none") {
        activemayor = currentmayor.innerText;
      } else if (eventmayor.value == 0) {
        activemayor = "";
      } else {
        activemayor = eventmayor.value;
      }
      if (activemayor != "Marina" && activemayor != "Diaz" && activemayor != "Cole") {
        console.log("Tripped failsafe");
        schedulebox.hidden = true;
        clearInterval(events2interval);
        nothingtoseehere.hidden = false;

        return;
      }
      if (activemayor == "Marina") {
        eventname = "Fishing Festival";
        eventcount = 12;
        eventduration = 3600000;
      }
      if (activemayor == "Diaz") {
        eventname = "Stonk Exchange";
        eventcount = 12;
        eventduration = 0;
      }
      if (activemayor == "Cole") {
        eventname = "Mining Fiesta";
        eventcount = 5;
        eventduration = 8400000;
      }
      
      var newyearstamp = 0;
      if ((Date.now()) - ((initial + year * yearlen) * 1000) > ((2 * monthlen + 27 * daylen) * 1000)){
         newyearstamp = new Date((initial + year * yearlen) * 1000);
         targetyear = year;
      } else {
         newyearstamp = new Date((initial + (year - 1) * yearlen) * 1000);
         targetyear = year - 1;
      }
      
      
      for (let i = 3; i < 15; i++) {
        times[i - 3] = ((initial + (targetyear * yearlen) + (i * monthlen)) * 1000);
      }
      console.log(times);
      for (let i = 0; i < eventcount; i++) {
        let eventspan = document.createElement("tr");
        eventspan.style.width = "100%";
        eventspan.id = "eventspan" + i;
        let span1 = document.createElement("td");
        
        span1.innerText = eventname + " " + (i + 1) + ": ";
        span1.style.paddingLeft = "20px";
        span1.style.textAlign = "left";
        let datetimespan = document.createElement("td");
        datetimespan.innerText = convertTimestamp(times[i]/1000);
        datetimespan.style.paddingLeft = "20px";
        datetimespan.style.textAlign = "right";
        let timespan = document.createElement("td");
        timespan.style.paddingLeft = "20px";
        timespan.style.textAlign = "right";
        timespan.id = "timer" + i;
        eventspan.appendChild(span1);
        eventspan.appendChild(datetimespan);
        eventspan.appendChild(timespan);
        schedulebox.appendChild(eventspan);

      }
      updateEvents2();
      events2interval = setInterval(updateEvents2, 1000);
    }
    var events2interval;
    var eventcount = 0;
    var eventduration = 0;
    function updateEvents2() {
      nothingtoseehere2.hidden = true;
      try {
        let timething = Date.now();
        var hiddenevents = 0;
        for (let i = 0; i < eventcount; i++) {

          let targetspan = document.getElementById("timer" + i);
          
          document.getElementById("eventspan" + i).hidden = false;
          if (i >= eventcount) {
            document.getElementById("eventspan" + i).hidden = true;
          }
          if (times[i] - timething > 0) {
            targetspan.innerText = "In " + betterTimestamp(Math.floor((times[i] - timething)/1000));
            if (Math.floor((times[i] - timething)/1000) == specnotibefore.value && specnotif.checked == true) {
              var mingrammar = "minutes";
              if (specnotibefore.value == 60){
                mingrammar = "minute";
              }
              var notification = new Notification("adjectils",  {body: eventname + " begins in " + Math.floor(specnotibefore.value/60) + " " + mingrammar, icon: "./favicon/favicon.ico"});
            }
          } else if (times[i] - timething > eventduration * -1) {
            targetspan.innerText = "For " + betterTimestamp(Math.floor(eventduration - (timething - times[i]))/1000);
          } else {
            document.getElementById("eventspan" + i).hidden = true;
            hiddenevents++;
          }
          if (hiddenevents == eventcount) {
            nothingtoseehere2.hidden = false;
            clearInterval(events2interval);
            console.log("No more events, cleared interval");
          }
        }
      } catch {
        clearInterval(events2interval);
        console.log("Cleared interval");
      }
      
    }
</script>