<!DOCTYPE html>
    <html lang = "en">
    <head>
        <meta name = "description" content = "Piscine utilities for Hypixel SkyBlock">
        <meta name = "author" content = "adjective_n0un">
        <meta name = "viewport" content="width=device-width, initial-scale=0.6">
        <title>adjectils - Fishing</title>
        <link rel="stylesheet" href = "/stylesheet.css">
        <link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
        <link rel="manifest" href="./favicon/site.webmanifest">
        <script type="text/javascript" src="/jquery-3.6.3.min.js"></script>
        <script src = "apireader.js"></script>
        <script src = "fishingdata.js"></script>
    </head>
    <body onload="updatePage()">
    <script>
    $(function(){
        $("#nav").load("nav.html", function() { setWord(); }); 
        $("#footer").load("footer.html", function() { setWord(); }); 
    });
    </script>
    <header id = "nav" class = navblock></header>
    <div style = "margin-bottom: 30px;">&nbsp;</div>
    <section class = "flex_box_index" style = "flex-basis: min(calc(100% - 30px), max(756px, 70%));">
        <div class = "flex_index_row" id = "trophyrow">
            <div class = "flex_index_box">
                <span class = "flex_full_row" style = "font-size: 24px; color:#e08000">Trophy Fishing</span>
                <span class = "flex_full_row"><label>Username: <input type = "text" id = "nameinput" style = "height:16px;" onchange = updateFish(value)>&nbsp;</label><button onclick = updateFish(nameinput.value) style = "width: 80px; text-align:center;">Refresh ⟳</button></span>
                <span id = "refreshstatus" class = "flex_full_row">Enter a username to continue.</span>
                <form action = "#" class = "flex_full_row">
                    <label>Profile:
                    <select id = profileid value = 4 onchange = updateProfileFish(nameinput.value)>
                        <option id = profile0 value = 0>–––––</option>
                        <option id = profile1 value = 1>–––––</option>
                        <option id = profile2 value = 2>–––––</option>
                        <option id = profile3 value = 3>–––––</option>
                        <option id = profile4 value = 4>–––––</option>
                    </select>
                    </label>
                </form>
                
                <span id = "status" class = "flex_full_row"></span>
                <span id = "profilestatus" class = "flex_full_row"></span>
                <form action = "#" class = "flex_full_row">
                    <label>Bait:
                    <select id = baitused value = 1.05 onchange = updateProfileFish(nameinput.value)>
                        <option value = 1.05>Hot Bait</option>
                        <option value = 1>Something else</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Rod:
                    <select id = rodused value = 1.2 onchange = updateProfileFish(nameinput.value)>
                        <option value = 1>Starter Lava Rod</option>
                        <option value = 1.1>Magma Rod</option>
                        <option value = 1.15>Inferno Rod</option>
                        <option value = 1.2>Hellfire Rod</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Armor:
                    <select id = armorused value = 1.1 onchange = updateProfileFish(nameinput.value)>
                        <option value = 1>Something else</option>
                        <option value = 1.05>Silver Hunter Armor</option>
                        <option value = 1.1>Gold Hunter Armor</option>
                        <option value = 1.15>Diamond Hunter Armor</option>
                    </select>
                    </label>
                </form>
                <label class = "flex_full_row">Kuudra Pet level (Epic+ rarity): <input type = "number" id = "kuudralevel" value = "100" style = "height:16px;width:48px" onchange = updateProfileFish(value)>&nbsp;</label>
                <div class = "flex_index_row flex_full_row" id = row1 style = "width:50%; flex-basis:51%; margin:auto; margin-top:10px;">
                    
                </div>
                <div class = "flex_index_row flex_full_row" id = row2 style = "width:50%; flex-basis:51%; margin:auto; margin-top:10px;">
                    
                </div>
                <div class = "flex_index_row flex_full_row" id = row3 style = "width:50%; flex-basis:51%; margin:auto; margin-top:10px;">
                    
                </div>
            </div>
        </div>
        <div class = "flex_index_row" id = "catchtablerow">
            <div class = "index_box" style = "width:49%;" id = "waterbox">
                <span style = "font-size: 24px; color:#4090f0;">Catch Table (Water)</span>
                <form action = "#" class = "flex_full_row">
                    <label>Location:
                    <select id = locationwater value = 0 onchange = updateWaterTable()>
                        <option value = "0">Somewhere else</option>
                        <option value = "1">The Park</option>
                        <option value = "2">Jerry Pond</option>
                        <option value = "3">Oasis</option>
                        <option value = "4">Crystal Hollows</option>
                        <option value = "5">Goblin Holdout</option>
                        <option value = "6">Abandoned Quarry</option>
                        <option value = "7">Backwater Bayou</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Hotspot active:
                    <select id = hotspot value = "0" onchange = updateWaterTable()>
                        <option value = "0">Not active</option>
                        <option value = "1">Active</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Spooky Festival:
                    <select id = spookyfest value = "0" onchange = updateWaterTable()>
                        <option value = "0">Not active</option>
                        <option value = "1">Active</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Fishing Festival:
                    <select id = marinafest value = "0" onchange = updateWaterTable()>
                        <option value = "0">Not active</option>
                        <option value = "1">Active</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Chumcap Bucket:
                    <select id = chumcap value = "0" onchange = updateWaterTable()>
                        <option value = "0">Not active</option>
                        <option value = "1">Active</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Bait:
                    <select id = bait value = "None" onchange = updateWaterTable()>
                        <option value = "None">Other</option>
                        <option value = "Carrot">Carrot Bait</option>
                        <option value = "Spooky">Spooky Bait</option>
                        <option value = "Shark">Shark Bait</option>
                        <option value = "Ice">Ice Bait</option>
                        <option value = "Frozen">Frozen Bait</option>
                        <option value = "Worm">Worm Bait</option>
                        <option value = "Whale">Whale Bait</option>
                        <option value = "Hotspot">Hotspot Bait</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Hook:
                    <select id = hook value = "None" onchange = updateWaterTable()>
                        <option value = "None">None</option>
                        <option value = "Common">Common Hook</option>
                        <option value = "Phantom">Phantom Hook</option>
                        <option value = "Oasis">Oasis Hook</option>
                        <option value = "Hotspot">Hotspot Hook</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Sinker:
                    <select id = sinker value = "None" onchange = updateWaterTable()>
                        <option value = "None">None</option>
                        <option value = "Icy">Icy Sinker</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Squid Hat:
                    <select id = squidhat value = "Other" onchange = updateWaterTable()>
                        <option value = "0">Not equipped</option>
                        <option value = "1">Equipped</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Spooky Hook:
                    <select id = spookyhook value = "1" onchange = updateWaterTable()>
                        <option value = "1">0</option>
                        <option value = "1.02">I</option>
                        <option value = "1.04">II</option>
                        <option value = "1.06">III</option>
                        <option value = "1.08">IV</option>
                        <option value = "1.1">V</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Icy Hook:
                    <select id = icyhook value = "1" onchange = updateWaterTable()>
                        <option value = "1">0</option>
                        <option value = "1.02">I</option>
                        <option value = "1.04">II</option>
                        <option value = "1.06">III</option>
                        <option value = "1.08">IV</option>
                        <option value = "1.1">V</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Shark Sonar:
                    <select id = sharksonar value = "1" onchange = updateWaterTable()>
                        <option value = "1">0</option>
                        <option value = "1.02">I</option>
                        <option value = "1.04">II</option>
                        <option value = "1.06">III</option>
                        <option value = "1.08">IV</option>
                        <option value = "1.1">V</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Drake Piper:
                    <select id = drakepiper value = "1" onchange = updateWaterTable()>
                        <option value = "1">0</option>
                        <option value = "1.02">I</option>
                        <option value = "1.04">II</option>
                        <option value = "1.06">III</option>
                        <option value = "1.08">IV</option>
                        <option value = "1.1">V</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Enderman Slayer Lv9:
                    <select id = es9water value = "0" onchange = updateWaterTable()>
                        <option value = "0">No</option>
                        <option value = "1">Yes</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Pet:
                    <select id = petselected value = "0" onchange = updateWaterTable()>
                        <option value = "0">Something else</option>
                        <option value = "1">Mythic Bat</option>
                        <option value = "2">Legendary Megalodon</option>
                        <option value = "3">Mythic Hermit Crab</option>
                    </select>
                    Level: <input type = "number" id = "petlevel" value = "100" style = "height:16px;width:48px" onchange = updateWaterTable()></label>
                </form>
                
                <table id = "watertable" style = "border-width:1px; margin-top:10px;">

                </table>
            </div>
            <div class = "index_box" style = "width:49%;" id = "lavabox">
                <span style = "font-size: 24px; color:#e08000;">Catch Table (Lava)</span>
                <form action = "#" class = "flex_full_row">
                    <label>Location:
                    <select id = locationlava value = "3" onchange = updateLavaTable()>
                        <option value = "0">Somewhere else</option>
                        <option value = "1">Magma Fields</option>
                        <option value = "2">Precursor Remnants</option>
                        <option value = "3">Crimson Isle</option>
                        <option value = "4">Plhlegblast Pool</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Hotspot active:
                    <select id = lavahotspot value = "0" onchange = updateLavaTable()>
                        <option value = "0">Not active</option>
                        <option value = "1">Active</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Bait:
                    <select id = lavabait value = "None" onchange = updateLavaTable()>
                        <option value = "None">No bait</option>
                        <option value = "Whale">Whale Bait</option>
                        <option value = "Hotspot">Hotspot Bait</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Hook:
                    <select id = lavahook value = "None" onchange = updateLavaTable()>
                        <option value = "None">No hook</option>
                        <option value = "Hotspot">Hotspot Hook</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Enderman Slayer Lv9:
                    <select id = es9 value = "0" onchange = updateLavaTable()>
                        <option value = "0">No</option>
                        <option value = "1">Yes</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Squid Hat:
                    <select id = squidhatlava value = "0" onchange = updateLavaTable()>
                        <option value = "0">Not equipped</option>
                        <option value = "1">Equipped</option>
                    </select>
                    </label>
                </form>
                <form action = "#" class = "flex_full_row">
                    <label>Pet:
                    <select id = lavapetselected value = "0" onchange = updateLavaTable()>
                        <option value = "0">Something else</option>
                        <option value = "1">Mythic Hermit Crab</option>
                    </select>
                    Level: <input type = "number" id = "lavapetlevel" value = "100" style = "height:16px;width:48px" onchange = updateWaterTable()></label>
                </form>
                <table id = "lavatable" style = "border-width:1px; margin-top:10px;">

                </table>
            </div>
        </div>
    </section>

    </body>
    <script>
pagedata = ["Fishing", "#78abde"];
        
        var rarities = ["bronze", "bronze", "bronze", "", "bronze", "bronze", "bronze", "bronze", "bronze", "bronze", "bronze", "bronze", "bronze", "bronze", "", "bronze", "bronze", "bronze", "bronze", "bronze", ""];
        var fishchances = [30, 25, 20, "", 20, 20, 15, 10, 10, 8, 4, "(User's Mana/1000)", 3, 3, "", 2, 2, 2, 1, "", ""];
        var fasttrack = false;
        var onCD = false;
        var data;

        //Empty out the rows when resetting them

        function reset(){
            for (var i = 1; i <= 3; i++){
                document.getElementById("row" + i).innerHTML = "";
            }
            document.getElementById("profilestatus").innerText = "";
            rarities = ["bronze", "bronze", "bronze", "", "bronze", "bronze", "bronze", "bronze", "bronze", "bronze", "bronze", "bronze", "bronze", "bronze", "", "bronze", "bronze", "bronze", "bronze", "bronze", ""];
        }

        //Updates the page with previous API data, if it exists, and fasttrack it to avoid calling the API again

        function updatePage(){
            updateSizes();
            document.getElementById("rodused").value = "1.2";
            document.getElementById("armorused").value = "1.1";
            if (localStorage.getItem("storedname") != null){
                console.log("Found a previous name and data! Loading...");
                console.log("Previous name: " + localStorage.getItem("storedname"));
                console.log("Previous data: " + localStorage.getItem("storeddata"));
                document.getElementById("nameinput").value = localStorage.getItem("storedname");
                data = JSON.parse(localStorage.getItem("storeddata"));
                fasttrack = true;
                updateFish(localStorage.getItem("storedname"));
            } else {
                setFish();
                addToolTips();
            }
            locationwater.value = "0";
            updateWaterTable();
            locationlava.value = "3";
            updateLavaTable();
        }

        var lastname;
        async function updateFish(name){

            //Rudimentary cooldown to avoid refresh spamming causing rate limits. Fast tracking does not trigger the cooldown.

            if (onCD == true){
                document.getElementById("refreshstatus").innerText = "Please wait 5 seconds before using this again.";
                console.log("On cooldown!");
                return -1;
            } else {
                document.getElementById("refreshstatus").innerText = "";
                if (!fasttrack){
                    onCD = true;
                    setTimeout(() => { onCD = false }, 5000);
                }
            }

            //Get the API data. Note that if we already have data from localstorage, this step will be skipped.

            UUID = await getUUIDbyName(name);
            if (UUID == -1) {
                return -1;
            }
            if (!fasttrack){
                data = await getAPIdata(UUID);
            } 
            fasttrack = false;
            if (data.profiles == null){
                reset();
                setFish();
                addToolTips();
                document.getElementById("status").innerText = "This player hasn't played on Hypixel!";
                return -1;
            }
            //Attempt to set the profile ID and list. If none can be found, the TypeError will be caught and an error message will appear.
            if (lastname != name) {
                updateProfiles(data);
            }
            lastname = name;
            

            //Deactivate fasttrack if applicable, then store the last name and api data in localStorage.

            localStorage.setItem("storedname", name);
            localStorage.setItem("storeddata", JSON.stringify(data)); 

            if (data != -1){    
                updateProfileFish();
            } else {
                setFish();
                addToolTips();
            }
            
        }

        //Function that is used as a checkpoint so that switching profiles does not call API and does not need a cooldown.
        var fishdata;
        function updateProfileFish(){
            console.log("Updating fish for " + UUID);
            //Start fresh

            reset();

            
            try {
                fishdata = data.profiles[profileid.value].members[UUID].trophy_fish;
            } catch (TypeError) {
                console.log("This profile hasn't trophy fished!");
                document.getElementById("profilestatus").innerText = "This profile has no trophy fishing stats!";
            }
            
            for (var i = 0; i < 21; i++){
                if (fishnames[i] != ""){
                    try {
                        if (fishdata[fishnames[i] + "_diamond"] > 0) {
                            rarities[i] = "diamond";
                        } else if (fishdata[fishnames[i] + "_gold"] > 0) {
                            rarities[i] = "gold";
                        } else if (fishdata[fishnames[i] + "_silver"] > 0) {
                            rarities[i] = "silver";
                        } else {
                            rarities[i] = "bronze";
                        }
                        
                    } catch (TypeError) {
                        console.log("Type error!");
                        document.getElementById("profilestatus").innerText = "This profile has no trophy fishing stats!";
                        setFish();
                        addToolTips();
                        return -1;
                    }
                }
            }

            //Generates the boxes for the trophy fish. Spaces are deliberately left in the fishnames array so that some boxes are left empty and hidden.
            
            setFish();

            //Initialize the hover element for each image telling the user more detail about each fish.

            addToolTips();

        }
        
        function setFish() {
            for (var j = 1; j <= 3; j++){
                for (var i = 7 * (j - 1); i < 7 * j; i++){
                    var box = document.createElement("div");
                    box.className = "fishbox";
                    box.id = fishnames[i] + "_box";
                    if (fishnames[i] == ""){
                        box.style.opacity = "0%";
                    } else {
                        var fishimage = document.createElement("img");
                        fishimage.src = "./images/trophy_fish/" + fishnames[i] + "_" + rarities[i] + ".png";
                        fishimage.style.height = "80%"; 
                        fishimage.style.width = "80%";
                        fishimage.alt = "";
                        box.appendChild(fishimage);
                        var tooltip = document.createElement("div");
                        tooltip.className = "fishboxtext";
                        tooltip.id = (fishnames[i] + "_text");
                        box.appendChild(tooltip);
                    }
                    document.getElementById("row" + j).appendChild(box);
                }
            }
        }

        function addToolTips() {

            updateChances();

            for (var i = 0; i < 21; i++){
                if (fishnames[i] != ""){
                    var title = document.createElement("span");
                    title.innerText = fishrealnames[i];
                    title.style.flexBasis = "100%";
                    title.style.color = fishrarities[i];
                    document.getElementById(fishnames[i] + "_text").appendChild(title);
                    document.getElementById(fishnames[i] + "_text").appendChild(document.createElement("br"));
                    var obtainment = document.createElement("span");
                    obtainment.innerText = fishchances[i] + methods[i];
                    document.getElementById(fishnames[i] + "_text").appendChild(obtainment);
                    obtainment.style.fontSize = "10px";
                    document.getElementById(fishnames[i] + "_text").appendChild(document.createElement("br"));
                    document.getElementById(fishnames[i] + "_text").appendChild(document.createElement("br"));
                    for (var j = 0; j < 5; j++){
                        var raritytext = document.createElement("span");
                        if (raritycontrol[j] != ""){
                            raritytext.innerText = (raritycontrol[j]).replace(/^.(\w)/, (match, p1) => p1.toUpperCase());
                        } else {
                            raritytext.innerText = "Total";
                        }
                        raritytext.style.color = raritycolors[j];
                        document.getElementById(fishnames[i] + "_text").appendChild(raritytext);
                        var fishcount = document.createElement("span");
                        try {
                            fishcount.innerText = (": " + (fishdata[fishnames[i] + raritycontrol[j]]).toLocaleString());    
                        } catch (TypeError) {
                            fishcount.innerText = (": 0");
                        }
                        
                        document.getElementById(fishnames[i] + "_text").appendChild(fishcount);
                        document.getElementById(fishnames[i] + "_text").appendChild(document.createElement("br"));
                    }
                
                }
            }
        } 

        function updateChances(){
            if (kuudralevel.value > 100){
                document.getElementById("kuudralevel").value = 100;
            }
            if (kuudralevel.value < 0 || isNaN(kuudralevel.value) || kuudralevel.value == ""){
                mf = 0;
                document.getElementById("kuudralevel").value = 0;
            }
            var fishmult = parseFloat(rodused.value) * parseFloat(baitused.value) * parseFloat(armorused.value) * (1 + (kuudralevel.value * 0.002));
            
            var fishchances2 = [30, 25, 20, "", 20, 20, 15, 10, 10, 8, 4, "(User's Mana/1000)", 3, 3, "", 2, 2, 2, 1, "", ""];
            for (var i = 0; i < 21; i++){
                
                fishchances[i] = (parseFloat(fishchances2[i]) * fishmult).toFixed(2);
                if (fishchances2[i] == "(User's Mana/1000)"){
                    var manachance = Math.floor(1000 / fishmult);
                    fishchances[i] = "(User's Mana/" + manachance + ")";
                }
                if (i == 19){
                    fishchances[i] = "";
                }
            }
        }
        window.addEventListener('resize', updateSizes());
        function updateSizes(){
            console.log("Current width: " + window.innerWidth);
            if (window.innerWidth >= 768 * (5/3)) {
                console.log("Desktop mode...");
                for (var i = 1; i <= 3; i++){
                    document.getElementById("row" + i).style.width = "50%";
                    document.getElementById("row" + i).style.flexBasis = "51%";
                }
                document.getElementById("catchtablerow").style.flexWrap = "nowrap";
                //document.getElementById("waterbox").style.flexBasis = "49%";
                document.getElementById("waterbox").style.width = "49%";
                //document.getElementById("lavabox").style.flexBasis = "49%";
                document.getElementById("lavabox").style.width = "49%";
            } else {
                console.log("Mobile mode...");
                for (var i = 1; i <= 3; i++){
                    document.getElementById("row" + i).style.width = "calc(100% - 30px)";
                    document.getElementById("row" + i).style.flexBasis = "calc(100% - 30px)";
                }
                document.getElementById("catchtablerow").style.flexWrap = "wrap";
                //document.getElementById("waterbox").style.flexBasis = "calc(100% - 30px)";
                document.getElementById("waterbox").style.width = "calc(100% - 30px)";
                //document.getElementById("lavabox").style.flexBasis = "calc(100% - 30px)";
                document.getElementById("lavabox").style.width = "calc(100% - 30px)";
          
            }
        }

        
        function updateWaterTable() {
            console.log(petlevel.value);
            if (petlevel.value > 100){
                document.getElementById("petlevel").value = 100;
            }
            if (petlevel.value < 1 || isNaN(petlevel.value) || petlevel.value == ""){
                mf = 0;
                document.getElementById("petlevel").value = 1;
            }
            //Clear previous data.

            watertable.innerHTML = "";

            var waterscweights = {
                "squid": 1200,
                "agarimoo": 950,
                "sea_walker": 800,
                "night_squid": 1100,
                "sea_guardian": 600,
                "sea_witch": 700,
                "sea_archer": 550,
                "rider_of_the_deep": 400,
                "catfish": 250,
                "carrot_king": 300,
                "sea_leech": 160,
                "guardian_defender": 130,
                "deep_sea_protector": 88,
                "water_hydra": 18,
                "sea_emperor": 10,
                "oasis_rabbit": 300,
                "oasis_sheep": 700,
                "mithril_grubber": 700,
                "water_worm": 300,
                "poisoned_water_worm": 300,
                "abyssal_miner": 90,
                "scarecrow": 1000,
                "nightmare": 550,
                "werewolf": 250,
                "phantom_fisher": 90,
                "grim_reaper": 25,
                "frozen_steve": 1100,
                "frosty": 800,
                "grinch": 50,
                "yeti": 30,
                "nutcracker": 60,
                "reindrake": 6,
                "nurse_shark": 1100,
                "blue_shark": 550,
                "tiger_shark": 300,
                "great_white_shark": 150,
                "trash_gobbler": 750,
                "dumpster_diver": 500,
                "banshee": 300,
                "bayou_sludge": 100,
                "alligator": 50,
                "titanoboa": 10,
                "frog_man": 1000,
                "snapping_turtle": 250,
                "blue_ringed_octopus": 25,
                "wiki_tiki": 5,
                "None": 0,
            }

            // Initialize the array. (This will get messy.)
            
            var activewaterscs = [];

            if (chumcap.value == "1"){
                activewaterscs.push("agarimoo");
            }
            if (locationwater.value == "1") {
                for (var i = 1; i < squids.length; i++){
                    activewaterscs.push(squids[i]);
                }
            }
            if (locationwater.value == "2") {
                for (var i = 0; i < winterscs.length; i++){
                    console.log("Pushed winter sc " + winterscs[i]);
                    activewaterscs.push(winterscs[i]);
                }
            }
            if (locationwater.value == "3") {
                for (var i = 0; i < oasisscs.length; i++){
                    activewaterscs.push(oasisscs[i]);
                }
            }
            if (locationwater.value == "4"){
                activewaterscs.push("abyssal_miner");
            }
            
            if (locationwater.value == "5"){
                for (var i = 0; i < goblinscs.length; i++){
                    activewaterscs.push(goblinscs[i]);
                }
            }
            if (locationwater.value == "6"){
                for (var i = 0; i < minesscs.length; i++){
                    activewaterscs.push(minesscs[i]);
                }
            }
            if (locationwater.value == "7"){
                for (var i = 0; i < bayouscs.length; i++){
                    activewaterscs.push(bayouscs[i]);
                }
                
            }
            if (hotspot.value == "1") {
                for (var i = 0; i < bayouhotspotscs.length; i++) {
                    activewaterscs.push(bayouhotspotscs[i]);
                }
            }
            if (spookyfest.value == "1"){
                for (var i = 0; i < spookyscs.length; i++){
                    activewaterscs.push(spookyscs[i]);
                }
            }
            if (marinafest.value == "1"){
                for (var i = 0; i < sharkscs.length; i++){
                    activewaterscs.push(sharkscs[i]);
                }
            }
            for (var i = 0; i < normalwaterscs.length; i++){
                activewaterscs.push(normalwaterscs[i]);
            }
            if (bait.value == "Carrot") {
                activewaterscs.push("carrot_king");
            }
            if (bait.value == "Worm") {
                if (locationwater.value == "5") {
                    activewaterscs = ["water_worm", "poisoned_water_worm"];
                } else {
                    activewaterscs = ["None"];
                }
                
            }
            
            

            

            if (bait.value == "Spooky") {
                for (var i = 0; i < spookyscs.length; i++){
                    waterscweights[spookyscs[i]] = waterscweights[spookyscs[i]] * 1.15;
                }
            }
            if (petselected.value == 1){
                for (var i = 0; i < spookyscs.length; i++){
                    waterscweights[spookyscs[i]] = waterscweights[spookyscs[i]] * (1 + (parseFloat(petlevel.value) * 0.0025));
                }
            }
            if (petselected.value == 2){
                for (var i = 0; i < sharkscs.length; i++){
                    waterscweights[sharkscs[i]] = waterscweights[sharkscs[i]] * (1.1 + (parseFloat(petlevel.value) * 0.001));
                }
                
            }
            if (petselected.value == 3){
                for (var i = 0; i < bayouhotspotscs.length; i++){
                    waterscweights[bayouhotspotscs[i]] = waterscweights[bayouhotspotscs[i]] * (1 + (parseFloat(petlevel.value) * 0.002));
                }
                
            }
            if (bait.value == "Shark") {   
                for (var i = 0; i < sharkscs.length; i++){
                    waterscweights[sharkscs[i]] = waterscweights[sharkscs[i]] * 1.15;
                }
            }
            if (bait.value == "Ice") {
                for (var i = 0; i < winterscs.length; i++){
                    waterscweights[winterscs[i]] = waterscweights[winterscs[i]] * 1.15;
                }
            }
            if (bait.value == "Frozen") {
                for (var i = 0; i < winterscs.length; i++){
                    waterscweights[winterscs[i]] = waterscweights[winterscs[i]] * 1.35;
                }
            }
            if (bait.value == "Whale") {
                for (var i = 0; i < activewaterscs.length; i++){
                    if (waterscweights[activewaterscs[i]] < 400){
                        waterscweights[activewaterscs[i]] = waterscweights[activewaterscs[i]] * 1.25;
                    }
                }
            }
            if (bait.value == "Hotspot") {
                for (var i = 0; i < bayouhotspotscs.length; i++){
                    waterscweights[bayouhotspotscs[i]] = waterscweights[bayouhotspotscs[i]] * 1.5;
                }
            }
            if (hook.value == "Common") {
                for (var i = 0; i < activewaterscs.length; i++){
                    console.log(scrarities[activewaterscs[i]]);
                    if (scrarities[activewaterscs[i]] == "common") {
                        waterscweights[activewaterscs[i]] *= 1.25;
                    }
                }
            }
            if (hook.value == "Phantom") {
                for (var i = 0; i < spookyscs.length; i++){
                    waterscweights[spookyscs[i]] = waterscweights[spookyscs[i]] * 1.35;
                }
            }
            if (hook.value == "Hotspot") {
                for (var i = 0; i < bayouhotspotscs.length; i++){
                    waterscweights[bayouhotspotscs[i]] = waterscweights[bayouhotspotscs[i]] * 2;
                }
            }
            if (hook.value == "Oasis") {
                //Oasis hook does nothing as of right now
            }
            if (sinker.value == "Icy") {
                for (var i = 0; i < winterscs.length; i++){
                    waterscweights[winterscs[i]] = waterscweights[winterscs[i]] * 3;
                }
            }
            
            if (squidhat.value == "1") {
                for (var i = 0; i < squids.length; i++){
                    waterscweights[squids[i]] = waterscweights[squids[i]] * 2;
                }
            }
            if (icyhook.value != "1") {
                for (var i = 0; i < winterscs.length; i++){
                    waterscweights[winterscs[i]] = waterscweights[winterscs[i]] * icyhook.value;
                }
            }
            if (spookyhook.value != "1") {
                for (var i = 0; i < spookyscs.length; i++){
                    waterscweights[spookyscs[i]] = waterscweights[spookyscs[i]] * spookyhook.value;
                }
            }
            if (sharksonar.value != "1") {
                for (var i = 0; i < sharkscs.length; i++){
                    waterscweights[sharkscs[i]] = waterscweights[sharkscs[i]] * sharksonar.value;
                }
            }
            if (drakepiper.value != "1") {
                waterscweights["reindrake"] = waterscweights["reindrake"] * parseFloat(drakepiper.value);
            }
            if (es9water.value == "1") {
                for (var i = 0; i < activewaterscs.length; i++){
                    console.log(scrarities[activewaterscs[i]]);
                    if (scrarities[activewaterscs[i]] == "mythic") {
                        waterscweights[activewaterscs[i]] *= 1.15;
                    }
                }
            }

            // Fill in the water table.
            var totalwaterweight = 0;
            for (var i = 0; i < activewaterscs.length; i++){
                totalwaterweight += waterscweights[activewaterscs[i]];
            }
            console.log("Total weight: " + totalwaterweight);
            console.log("Active: " + activewaterscs); 
            for (var i = 0; i < activewaterscs.length; i++){
                
                var scrow = document.createElement("tr");
                var infotd = document.createElement("td");
                infotd.innerText = waterscnames[activewaterscs[i]];
                infotd.style.paddingRight = "60px";
                infotd.style.color = raritycolors2[scrarities[activewaterscs[i]]];
                var chancetd = document.createElement("td");
                if (totalwaterweight != 0){
                    chancetd.innerText = (100 * (waterscweights[activewaterscs[i]] / totalwaterweight)).toFixed(3) + "%";
                } else {
                    chancetd.innerText = "100%";
                    infotd.innerText = "None";
                }
                
                chancetd.style.textAlign = "right";
                scrow.appendChild(infotd);
                scrow.appendChild(chancetd);
                watertable.appendChild(scrow);
            }

            updateTableHeights();

        }
        function updateLavaTable(){
            // Initialization

            lavatable.innerHTML = "";
            var lavascweights = {
                "magma_slug": 1600,
                "moogma": 1200,
                "fried_chicken": 1000,
                "lava_leech": 600,
                "pyroclastic_worm": 400,
                "lava_flame": 360,
                "fire_eel": 280,
                "fireproof_witch": 250,
                "taurus": 160,
                "fiery_scuttler": 25,
                "plhlegblast": 0,
                "thunder": 40,
                "lord_jawbus": 8,
                "ragnarok": 5,
                "flaming_worm": 180,
                "lava_blaze": 36,
                "lava_pigman": 36,
                "None": 0,
            }
            activelavascs = [];

            // Fill lava sc array. (This will get messy.)
            if (locationlava.value == "0") {
                activelavascs = ["None"];
            }
            if (locationlava.value == "1") {
                activelavascs = magmascs;
            }
            if (locationlava.value == "2") {
                activelavascs = precursorscs;
            }
            if (locationlava.value == "3") {
                if (lavahotspot.value == "1") {
                    for (var i = 0; i < lavahotspotscs.length; i++) {
                        activelavascs.push(lavahotspotscs[i]);
                    }
                }
                for (var i = 0; i < crimsonscs.length; i++) {
                    activelavascs.push(crimsonscs[i]);
                }
                
            }
            if (locationlava.value == "4") {
                if (lavahotspot.value == "1") {
                    for (var i = 0; i < lavahotspotscs.length; i++) {
                        activelavascs.push(lavahotspotscs[i]);
                    }
                }
                for (var i = 0; i < plhlegblastscs.length; i++) {
                    activelavascs.push(plhlegblastscs[i]);
                }
            }
            if (lavabait.value == "Whale") {
                for (var i = 0; i < activelavascs.length; i++){
                    if (lavascweights[activelavascs[i]] < 400){
                        lavascweights[activelavascs[i]] = lavascweights[activelavascs[i]] * 1.25;
                    }
                }
            }
            if (lavabait.value == "Hotspot") {
                for (var i = 0; i < lavahotspotscs.length; i++){
                    lavascweights[lavahotspotscs[i]] = lavascweights[lavahotspotscs[i]] * 1.5;
                }
            }
            if (lavahook.value == "Hotspot") {
                for (var i = 0; i < lavahotspotscs.length; i++){
                    lavascweights[lavahotspotscs[i]] = lavascweights[lavahotspotscs[i]] * 2;
                }
            }
            if (lavapetselected.value == 1){
                for (var i = 0; i < lavahotspotscs.length; i++){
                    lavascweights[lavahotspotscs[i]] = lavascweights[lavahotspotscs[i]] * (1 + (parseFloat(petlevel.value) * 0.002));
                }
                
            }
            if (es9.value == "1") {
                lavascweights["lord_jawbus"] = lavascweights["lord_jawbus"] * 1.15;
                lavascweights["ragnarok"] = lavascweights["ragnarok"] * 1.15;
            }
            var totallavaweight = 0;
            for (var i = 0; i < activelavascs.length; i++){
                totallavaweight += lavascweights[activelavascs[i]];
            }
            console.log("Total lava weight: " + totallavaweight);
            for (var i = 0; i < activelavascs.length; i++){
                var scrow = document.createElement("tr");
                var infotd = document.createElement("td");
                infotd.innerText = lavascnames[activelavascs[i]];
                infotd.style.paddingRight = "60px";
                infotd.style.color = raritycolors2[scrarities[activelavascs[i]]];
                var chancetd = document.createElement("td");
                if (totallavaweight != 0){
                    if (activelavascs[i] == "plhlegblast" && squidhatlava.value == "0") {
                        lavascweights["plhlegblast"] = 1/999 * totallavaweight;
                        totallavaweight *= 1000/999;
                    } else if (activelavascs[i] == "plhlegblast" && squidhatlava.value == "1") {
                        lavascweights["plhlegblast"] = 1/499 * totallavaweight;
                        totallavaweight *= 500/499;
                    }
                    chancetd.innerText = (100 * (lavascweights[activelavascs[i]] / totallavaweight)).toFixed(3) + "%";
                } else {
                    chancetd.innerText = "100%";
                    infotd.innerText = "None";
                }
                
                chancetd.style.textAlign = "right";
                scrow.appendChild(infotd);
                scrow.appendChild(chancetd);
                lavatable.appendChild(scrow);
            }
            updateTableHeights();
        }
        function updateTableHeights() {
            const water_box = document.getElementById('waterbox');
            const lava_box = document.getElementById('lavabox');
            water_box.style.height = "auto";
            lava_box.style.height = "auto";
            const catch_table_row = document.getElementById('catchtablerow');
            const trophy_row = document.getElementById('trophyrow');
            const waterrect = water_box.getBoundingClientRect();
            const lavarect = lava_box.getBoundingClientRect();
            const catchrect = catch_table_row.getBoundingClientRect();
            const trophyrect = trophy_row.getBoundingClientRect();
            
            const maxHeight = Math.max(waterrect.height, lavarect.height);
            water_box.style.height = `${maxHeight}px`;
            lava_box.style.height = `${maxHeight}px`;
            catch_table_row.style.width = `${trophyrect.width}px`;
        }
    </script>